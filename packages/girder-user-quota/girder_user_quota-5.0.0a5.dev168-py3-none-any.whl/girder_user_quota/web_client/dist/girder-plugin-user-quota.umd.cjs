(function(C){typeof define=="function"&&define.amd?define(C):C()})(function(){"use strict";const C="";function j(r){var u=0;if(r)for(u=0;u<4&&parseInt(r/1024,10)*1024===r;u+=1)r/=1024;else r!==0&&(r="");return{sizeUnits:u,sizeValue:r}}function E(r,u){var i=r,e,t,o="bkMGT";if(parseFloat(r)>0){if(i=parseFloat(r),e=r.match(new RegExp("^\\s*[0-9.]+\\s*(["+o+"])","i")),e&&e.length>1)for(u=0;u<o.length&&e[1].toLowerCase()!==o[u].toLowerCase();u+=1);for(t=0;t<parseInt(u,10);t+=1)i*=1024;i=parseInt(i,10)}return i}function n(r,u,i,e){if(u===!1||u==null||!u&&(r==="class"||r==="style"))return"";if(u===!0)return" "+(e?r:r+'="'+r+'"');var t=typeof u;return t!=="object"&&t!=="function"||typeof u.toJSON!="function"||(u=u.toJSON()),typeof u=="string"||(u=JSON.stringify(u),i||u.indexOf('"')===-1)?(i&&(u=f(u))," "+r+'="'+u+'"'):" "+r+"='"+u.replace(/'/g,"&#39;")+"'"}function f(r){var u=""+r,i=k.exec(u);if(!i)return r;var e,t,o,s="";for(e=i.index,t=0;e<u.length;e++){switch(u.charCodeAt(e)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}t!==e&&(s+=u.substring(t,e)),t=e+1,s+=o}return t!==e?s+u.substring(t,e):s}var k=/["&<>]/;function y(r,u,i,e){if(!(r instanceof Error))throw r;if(!(typeof window>"u"&&u||e))throw r.message+=" on line "+i,r;var t,o,s,c;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),t=3,o=e.split(`
`),s=Math.max(i-t,0),c=Math.min(o.length,i+t)}catch(l){return r.message+=" - could not read from "+u+" ("+l.message+")",void y(r,null,i)}t=o.slice(s,c).map(function(l,p){var F=p+s+1;return(F==i?"  > ":"    ")+F+"| "+l}).join(`
`),r.path=u;try{r.message=(u||"Pug")+":"+i+`
`+t+`

`+r.message}catch{}throw r}function T(r){var u="",i,e,t;try{var o=r||{};(function(s){t=1,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<div class="g-config-breadcrumb-container"></div>',t=2,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<p class="g-quota-description">',t=3,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"Quotas limit the maximum storage space available for each user and",t=4,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+`
`,t=4,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"collection.</p>",t=5,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<form id="g-user-quota-form" role="form">',t=6,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",(function(){var c=s;if(typeof c.length=="number")for(var l=0,p=c.length;l<p;l++){var F=c[l];t=7,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<div class="form-group">',t=8,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+n("for",`g-user-quota-${F.model}-size-value`,!0,!1))+">",t=9,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"Default ",t=9,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+f((i=F.name)==null?"":i),t=9,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+" File Size Quota</label>",t=10,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<p class="g-quota-description">',t=11,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"This is the maximum allowed size of all files for",t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+`
`,t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"individual ",t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+f((i=F.model)==null?"":i),t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"s, unless that ",t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+f((i=F.model)==null?"":i),t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"'s",t=13,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+`
`,t=13,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"quota is explicitly set.</p>",t=14,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm g-sizeValue form-control"'+n("id",`g-user-quota-${F.model}-size-value`,!0,!1)+' type="text"'+n("value",F.sizeValue,!0,!1)+' placeholder="Maximum allowed size of all files, or blank for no limit"')+"/>",t=18,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<select"+(' class="form-control input-sm g-sizeUnits"'+n("id",`g-user-quota-${F.model}-size-units`,!0,!1))+">",t=20,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="0"'+n("selected",F.sizeUnits===0,!0,!1))+">",t=20,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"bytes</option>",t=21,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="1"'+n("selected",F.sizeUnits===1,!0,!1))+">",t=21,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"kB</option>",t=22,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="2"'+n("selected",F.sizeUnits===2,!0,!1))+">",t=22,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"MB</option>",t=23,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="3"'+n("selected",F.sizeUnits===3,!0,!1))+">",t=23,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"GB</option>",t=24,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="4"'+n("selected",F.sizeUnits===4,!0,!1))+">",t=24,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"TB</option></select></div>"}else{var p=0;for(var l in c){p++;var F=c[l];t=7,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<div class="form-group">',t=8,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<label"+(' class="control-label"'+n("for",`g-user-quota-${F.model}-size-value`,!0,!1))+">",t=9,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"Default ",t=9,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+f((i=F.name)==null?"":i),t=9,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+" File Size Quota</label>",t=10,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<p class="g-quota-description">',t=11,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"This is the maximum allowed size of all files for",t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+`
`,t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"individual ",t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+f((i=F.model)==null?"":i),t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"s, unless that ",t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+f((i=F.model)==null?"":i),t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"'s",t=13,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+`
`,t=13,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"quota is explicitly set.</p>",t=14,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<input"+(' class="input-sm g-sizeValue form-control"'+n("id",`g-user-quota-${F.model}-size-value`,!0,!1)+' type="text"'+n("value",F.sizeValue,!0,!1)+' placeholder="Maximum allowed size of all files, or blank for no limit"')+"/>",t=18,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<select"+(' class="form-control input-sm g-sizeUnits"'+n("id",`g-user-quota-${F.model}-size-units`,!0,!1))+">",t=20,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="0"'+n("selected",F.sizeUnits===0,!0,!1))+">",t=20,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"bytes</option>",t=21,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="1"'+n("selected",F.sizeUnits===1,!0,!1))+">",t=21,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"kB</option>",t=22,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="2"'+n("selected",F.sizeUnits===2,!0,!1))+">",t=22,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"MB</option>",t=23,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="3"'+n("selected",F.sizeUnits===3,!0,!1))+">",t=23,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"GB</option>",t=24,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"<option"+(' value="4"'+n("selected",F.sizeUnits===4,!0,!1))+">",t=24,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+"TB</option></select></div>"}}}).call(this),t=25,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<p class="g-validation-failed-message" id="g-user-quota-error-message"></p>',t=26,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/configView.pug",u=u+'<input class="btn btn-sm btn-primary" type="submit" value="Save"/></form>'}).call(this,"resources"in o?o.resources:typeof resources<"u"?resources:void 0)}catch(s){y(s,e,t)}return u}const N=girder.views.widgets.PluginConfigBreadcrumbWidget,O=girder.views.View,{restRequest:W}=girder.rest,D=girder.events;var B=O.extend({events:{"submit #g-user-quota-form":function(r){r.preventDefault(),this.$("#g-user-quota-error-message").empty(),this._saveSettings([{key:"user_quota.default_user_quota",value:E(this.$("#g-user-quota-user-size-value").val(),this.$("#g-user-quota-user-size-units").val())},{key:"user_quota.default_collection_quota",value:E(this.$("#g-user-quota-collection-size-value").val(),this.$("#g-user-quota-collection-size-units").val())}])}},initialize:function(){W({method:"GET",url:"system/setting",data:{list:JSON.stringify(["user_quota.default_user_quota","user_quota.default_collection_quota"])}}).done(r=>{this.settings=r,this.render()})},render:function(){var r=j(this.settings["user_quota.default_user_quota"]),u=j(this.settings["user_quota.default_collection_quota"]);return this.$el.html(T({resources:{user:{model:"user",name:"User",sizeValue:r.sizeValue,sizeUnits:r.sizeUnits},collection:{model:"collection",name:"Collection",sizeValue:u.sizeValue,sizeUnits:u.sizeUnits}}})),this.breadcrumb||(this.breadcrumb=new N({pluginName:"User and collection quotas and policies",el:this.$(".g-config-breadcrumb-container"),parentView:this}).render()),this},_saveSettings:function(r){W({method:"PUT",url:"system/setting",data:{list:JSON.stringify(r)},error:null}).done(()=>{D.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})}).fail(u=>{this.$("#g-user-quota-error-message").text(u.responseJSON.message)})}});const L=girder.router,J=girder.events,{exposePluginConfig:I}=girder.utilities.PluginUtils;I("user_quota","plugins/user_quota/config"),L.route("plugins/user_quota/config","userQuotaConfig",function(){J.trigger("g:navigateTo",B)});const G=girder.collections.AssetstoreCollection,{getCurrentUser:V}=girder.auth,{restRequest:P}=girder.rest;function z(r,u){r.prototype.updateQuotaPolicy=function(){return P({url:`${this.resourceName}/${this.id}/quota`,method:"PUT",error:null,data:{policy:JSON.stringify(this.get("quotaPolicy"))}}).done(()=>{this.trigger("g:quotaPolicySaved")}).fail(i=>{this.trigger("g:error",i)}),this},r.prototype.fetchQuotaPolicy=function(i){return this.off("g:fetched").on("g:fetched",function(){this.fetchAssetstores(i)}),!this.get("quotaPolicy")||i?P({url:`${this.resourceName}/${this.id}/quota`,method:"GET"}).done(e=>{this.set("quotaPolicy",e.quota),this.fetch()}).fail(e=>{this.trigger("g:error",e)}):this.fetch(),this},r.prototype.fetchAssetstores=function(i){return V().get("admin")&&(!this.get("assetstoreList")||i)?(this.set("assetstoreList",new G),this.get("assetstoreList").on("g:changed",function(){this.fetchDefaultQuota(i)},this).fetch()):this.fetchDefaultQuota(i),this},r.prototype.fetchDefaultQuota=function(i){return V().get("admin")&&(!this.get("defaultQuota")||i)?P({url:"system/setting",method:"GET",data:{key:"user_quota.default_"+u+"_quota"}}).done(e=>{this.set("defaultQuota",e),this.trigger("g:quotaPolicyFetched")}):this.trigger("g:quotaPolicyFetched"),this}}const R=girder.models.CollectionModel;z(R,"collection");const H=girder.models.UserModel;z(H,"user");function $(r,u,i,e){if(!(r instanceof Error))throw r;if(!(typeof window>"u"&&u||e))throw r.message+=" on line "+i,r;var t,o,s,c;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),t=3,o=e.split(`
`),s=Math.max(i-t,0),c=Math.min(o.length,i+t)}catch(l){return r.message+=" - could not read from "+u+" ("+l.message+")",void $(r,null,i)}t=o.slice(s,c).map(function(l,p){var F=p+s+1;return(F==i?"  > ":"    ")+F+"| "+l}).join(`
`),r.path=u;try{r.message=(u||"Pug")+":"+i+`
`+t+`

`+r.message}catch{}throw r}function K(r){var u="",i,e;try{var t=r||{};(function(o,s,c){e=1,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",s.getAccessLevel()>=o.ADMIN&&(e=2,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",u=u+'<li role="presentation">',e=3,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",u=u+'<a class="g-collection-policies" role="menuitem">',e=4,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",u=u+'<i class="icon-box"></i>',e=5,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",c.get("admin")?(e=6,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",u=u+"Quota and assetstore policies"):(e=8,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/collectionViewPoliciesMenu.pug",u=u+"Quota"),u=u+"</a></li>")}).call(this,"AccessType"in t?t.AccessType:typeof AccessType<"u"?AccessType:void 0,"collection"in t?t.collection:typeof collection<"u"?collection:void 0,"currentUser"in t?t.currentUser:typeof currentUser<"u"?currentUser:void 0)}catch(o){$(o,i,e)}return u}function a(r,u,i,e){if(u===!1||u==null||!u&&(r==="class"||r==="style"))return"";if(u===!0)return" "+(e?r:r+'="'+r+'"');var t=typeof u;return t!=="object"&&t!=="function"||typeof u.toJSON!="function"||(u=u.toJSON()),typeof u=="string"||(u=JSON.stringify(u),i||u.indexOf('"')===-1)?(i&&(u=m(u))," "+r+'="'+u+'"'):" "+r+"='"+u.replace(/'/g,"&#39;")+"'"}function m(r){var u=""+r,i=X.exec(u);if(!i)return r;var e,t,o,s="";for(e=i.index,t=0;e<u.length;e++){switch(u.charCodeAt(e)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}t!==e&&(s+=u.substring(t,e)),t=e+1,s+=o}return t!==e?s+u.substring(t,e):s}var X=/["&<>]/;function Q(r,u,i,e){if(!(r instanceof Error))throw r;if(!(typeof window>"u"&&u||e))throw r.message+=" on line "+i,r;var t,o,s,c;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),t=3,o=e.split(`
`),s=Math.max(i-t,0),c=Math.min(o.length,i+t)}catch(l){return r.message+=" - could not read from "+u+" ("+l.message+")",void Q(r,null,i)}t=o.slice(s,c).map(function(l,p){var F=p+s+1;return(F==i?"  > ":"    ")+F+"| "+l}).join(`
`),r.path=u;try{r.message=(u||"Pug")+":"+i+`
`+t+`

`+r.message}catch{}throw r}function Y(r){var u="",i,e,t;try{var o=r||{};(function(s,c,l,p,F,q,v,M){t=1,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="modal-dialog">',t=2,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="modal-content">',t=3,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<form class="modal-form" id="g-policies-edit-form" role="form">',t=4,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="modal-header">',t=5,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<button class="close" data-dismiss="modal" aria-hidden="true" type="button">',t=5,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"&times;</button>",t=6,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<h4 class="modal-title">',t=7,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",l.get("admin")?(t=8,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Quota and Assetstore Policies for ",t=8,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=F)==null?"":i)):(t=10,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Quota for ",t=10,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=F)==null?"":i)),u=u+"</h4></div>",t=11,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="modal-body">',t=12,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<div>",t=13,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<b>",t=13,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Quota:</b>",t=14,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<span class="g-quota-capacity">',t=14,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=c)==null?"":i)+"</span>",t=15,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="g-quota-capacity-chart"></div></div>',t=16,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",l.get("admin")&&(t=17,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="form-group">',t=18,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<label class="control-label" for="g-user-quota-size-value">',t=18,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"File Size Quota</label>",t=19,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<p class="g-quota-description">',t=20,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"This is the maximum allowed size of all files.</p>",t=21,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="radio">',t=22,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<label>",t=23,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<input"+(' id="g-defaultQuota" type="radio" name="defaultQuota" value="True"'+a("checked",q.useQuotaDefault!==!1,!0,!1))+"/>",t=25,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Use the default quota: ",t=25,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=p)==null?"":i)+"</label></div>",t=26,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="radio g-customQuota">',t=27,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<label>",t=28,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<input"+(' id="g-customQuota" type="radio" name="defaultQuota" value="False"'+a("checked",q.useQuotaDefault===!1,!0,!1))+"/>",t=30,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Use a specific quota:</label></div>",t=31,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<input"+(' class="input-sm g-sizeValue form-control" id="g-user-quota-size-value" type="text"'+a("value",M||"",!0,!1)+' placeholder="Maximum allowed size of all files, or blank for no limit"')+"/>",t=34,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<select class="form-control input-sm g-sizeUnits" id="g-user-quota-size-units">',t=35,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="0"'+a("selected",v===0,!0,!1))+">",t=35,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"bytes</option>",t=36,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="1"'+a("selected",v===1,!0,!1))+">",t=36,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"kB</option>",t=37,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="2"'+a("selected",v===2,!0,!1))+">",t=37,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"MB</option>",t=38,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="3"'+a("selected",v===3,!0,!1))+">",t=38,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"GB</option>",t=39,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="4"'+a("selected",v===4,!0,!1))+">",t=39,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"TB</option></select></div>",t=40,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="form-group">',t=41,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<label class="control-label" for="g-preferredAssetstore">',t=41,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Preferred Assetstore</label>",t=42,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<p class="g-quota-description">',t=43,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Any file that is uploaded will be sent to this assetstore.",t=44,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+`
`,t=44,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Existing files are not moved.</p>",t=45,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<select class="form-control input-sm" id="g-preferredAssetstore">',t=46,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="current"'+a("selected",!q.preferredAssetstore,!0,!1))+">",t=46,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Current Assetstore</option>",t=47,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",(function(){var d=s;if(typeof d.length=="number")for(var _=0,b=d.length;_<b;_++){var g=d[_];t=48,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(a("value",g.id,!0,!1)+a("selected",q.preferredAssetstore===g.id,!0,!1))+">",t=48,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=g.name())==null?"":i)+"</option>"}else{var b=0;for(var _ in d){b++;var g=d[_];t=48,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(a("value",g.id,!0,!1)+a("selected",q.preferredAssetstore===g.id,!0,!1))+">",t=48,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=g.name())==null?"":i)+"</option>"}}}).call(this),u=u+"</select></div>",t=49,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="form-group">',t=50,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<label class="control-label" for="g-fallbackAssetstore">',t=50,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Fallback Assetstore</label>",t=51,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<p class="g-quota-description">',t=52,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"This assetstore is used if the preferred assetstore is offline or",t=53,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+`
`,t=53,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"unavailable.</p>",t=54,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<select class="form-control input-sm" id="g-fallbackAssetstore">',t=55,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="current"'+a("selected",!q.fallbackAssetstore,!0,!1))+">",t=55,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Current Assetstore</option>",t=56,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",(function(){var d=s;if(typeof d.length=="number")for(var _=0,b=d.length;_<b;_++){var g=d[_];t=57,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(a("value",g.id,!0,!1)+a("selected",q.fallbackAssetstore===g.id,!0,!1))+">",t=57,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=g.name())==null?"":i)+"</option>"}else{var b=0;for(var _ in d){b++;var g=d[_];t=57,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(a("value",g.id,!0,!1)+a("selected",q.fallbackAssetstore===g.id,!0,!1))+">",t=57,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+m((i=g.name())==null?"":i)+"</option>"}}}).call(this),t=58,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"<option"+(' value="none"'+a("selected",q.fallbackAssetstore==="none",!0,!1))+">",t=58,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"None</option></select></div>",t=59,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="g-validation-failed-message"></div>'),u=u+"</div>",t=60,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<div class="modal-footer">',t=61,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",l.get("admin")?(t=62,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<a class="btn btn-small btn-default" data-dismiss="modal">',t=62,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Cancel</a>",t=63,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<button class="g-save-policies btn btn-small btn-primary" type="submit">',t=64,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<i class="icon-edit"></i>',t=65,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Save</button>"):(t=67,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+'<a class="btn btn-small btn-default" data-dismiss="modal">',t=67,e="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/quotaPoliciesWidget.pug",u=u+"Close</a>"),u=u+"</div></form></div></div>"}).call(this,"assetstoreList"in o?o.assetstoreList:typeof assetstoreList<"u"?assetstoreList:void 0,"capacityString"in o?o.capacityString:typeof capacityString<"u"?capacityString:void 0,"currentUser"in o?o.currentUser:typeof currentUser<"u"?currentUser:void 0,"defaultQuotaString"in o?o.defaultQuotaString:typeof defaultQuotaString<"u"?defaultQuotaString:void 0,"name"in o?o.name:typeof name<"u"?name:void 0,"quotaPolicy"in o?o.quotaPolicy:typeof quotaPolicy<"u"?quotaPolicy:void 0,"sizeUnits"in o?o.sizeUnits:typeof sizeUnits<"u"?sizeUnits:void 0,"sizeValue"in o?o.sizeValue:typeof sizeValue<"u"?sizeValue:void 0)}catch(s){Q(s,e,t)}return u}const h=girder.$,Z=girder._,S=girder.views.View,{getCurrentUser:u0}=girder.auth,{formatSize:w}=girder.misc,{handleOpen:e0,handleClose:t0}=girder.dialog;var i0=S.extend({events:{"submit #g-policies-edit-form":function(r){var u;r.preventDefault(),u={fileSizeQuota:this.$("#g-fileSizeQuota").val(),useQuotaDefault:h("input:radio[name=defaultQuota]:checked").val()==="True",preferredAssetstore:this.$("#g-preferredAssetstore").val(),fallbackAssetstore:this.$("#g-fallbackAssetstore").val()},u.fileSizeQuota=E(this.$("#g-user-quota-size-value").val(),this.$("#g-user-quota-size-units").val()),this.updateQuotaPolicies(u),this.$("button.g-save-policies").girderEnable(!1),this.$(".g-validation-failed-message").text("")},"input #g-user-quota-size-value":"_selectCustomQuota","change #g-user-quota-size-units":"_selectCustomQuota"},initialize:function(r){this.model=r.model,this.modelType=r.modelType,this.plots=[],this.model.off("g:quotaPolicyFetched").on("g:quotaPolicyFetched",function(){this.render()},this).fetchQuotaPolicy()},destroy:function(){this._destroyPlots(),S.prototype.destroy.call(this)},_destroyPlots:function(){for(const r of this.plots)r.data("jqplot").destroy();this.plots=[]},_selectCustomQuota:function(){h("#g-customQuota").prop("checked",!0)},capacityChart:function(r,u){var i,e,t,o=r.model.get("quotaPolicy").fileSizeQuota;if(r.model.get("quotaPolicy").useQuotaDefault!==!1&&(o=r.model.get("defaultQuota"),o||(o=this.model.get("quotaPolicy")._currentFileSizeQuota)),!o){h(u).addClass("g-no-chart");return}h(u).addClass("g-has-chart"),i=r.model.get("size"),e=Math.max(o-i,0),t=[["Used ("+w(i)+")",i],["Free ("+w(e)+")",e]];var s=h(u).jqplot([t],{seriesDefaults:{renderer:h.jqplot.PieRenderer,rendererOptions:{sliceMargin:2,shadow:!1,highlightMouseOver:!1,showDataLabels:!0,padding:5,startAngle:180}},legend:{show:!0,location:"e",background:"transparent",border:"none"},grid:{background:"transparent",border:"none",borderWidth:0,shadow:!1},gridPadding:{top:10,right:10,bottom:10,left:10}});this.plots.push(s)},capacityString:function(){var r,u,i=this.model.get("quotaPolicy").fileSizeQuota;return this.model.get("quotaPolicy").useQuotaDefault!==!1&&(i=this.model.get("defaultQuota"),i||(i=this.model.get("quotaPolicy")._currentFileSizeQuota)),!i&&i!==0?"Unlimited":(r=this.model.get("size"),u=i-r,u>0?w(u)+" free of "+w(i):"No space left of "+w(i))},render:function(){var r,u,i,e,t=this.model.name(),o=u0();return r=j(this.model.get("quotaPolicy").fileSizeQuota),u=this.model.get("defaultQuota"),!u&&u!==0?i="Unlimited":i=w(u),this._destroyPlots(),e=this.$el.html(Y({currentUser:o,model:this.model,modelType:this.modelType,name:t,quotaPolicy:this.model.get("quotaPolicy"),sizeValue:r.sizeValue,sizeUnits:r.sizeUnits,assetstoreList:o.get("admin")?this.model.get("assetstoreList").models:void 0,capacityString:" "+this.capacityString(),defaultQuotaString:i})).girderModal(this).on("shown.bs.modal",()=>{this.$("#g-fileSizeQuota").trigger("focus"),this.capacityChart(this,".g-quota-capacity-chart")}).on("hidden.bs.modal",()=>{t0("quota"),this.trigger("g:hidden")}),e.trigger(h.Event("ready.girder.modal",{relatedTarget:e})),this.$("#g-fileSizeQuota").trigger("focus"),e0("quota"),this},updateQuotaPolicies:function(r){Z.each(r,(u,i)=>{this.model.get("quotaPolicy")[i]=u}),this.model.on("g:quotaPolicySaved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.model)},this).off("g:error").on("g:error",function(u){this.$(".g-validation-failed-message").text(u.responseJSON.message),this.$("button.g-save-policies").girderEnable(!0),this.$("#g-"+u.responseJSON.field).trigger("focus")},this).updateQuotaPolicy()}});const U=girder.$,{AccessType:r0}=girder.constants,{getCurrentUser:o0}=girder.auth,{wrap:s0}=girder.utilities.PluginUtils;function A(r,u,i){var e="click .g-"+i+"-policies";r.prototype.events[e]="editPolicies";var t=r.prototype.initialize;r.prototype.initialize=function(o){this.quota=(o||{}).dialog==="quota",t.apply(this,arguments)},s0(r,"render",function(o){var s,c;o.call(this),s=U(".g-"+i+"-header a.g-delete-"+i).closest("li"),c={AccessType:r0,currentUser:o0()},c[i]=this.model,s.before(u(c)),this.quota&&(this.quota=null,this.editPolicies())}),r.prototype.editPolicies=function(){var o=new i0({el:U("#g-dialog-container"),model:this.model,modelType:i,parentView:this}).on("g:saved",function(){this.render()},this).on("g:hidden",function(){o.destroy()})}}const F0=girder.views.body.CollectionView;A(F0,K,"collection");const{wrap:l0}=girder.utilities.PluginUtils,c0=girder.views.widgets.UploadWidget;l0(c0,"uploadNextFile",function(r){this.$(".g-drop-zone").addClass("hide"),r.call(this),this.currentFile.on("g:upload.error",function(u){u.identifier==="user_quota.upload-exceeds-quota"&&this.$(".g-drop-zone").removeClass("hide")},this).on("g:upload.errorStarting",function(u){u.identifier==="user_quota.upload-exceeds-quota"&&this.$(".g-drop-zone").removeClass("hide")},this)});function x(r,u,i,e){if(!(r instanceof Error))throw r;if(!(typeof window>"u"&&u||e))throw r.message+=" on line "+i,r;var t,o,s,c;try{e=e||require("fs").readFileSync(u,{encoding:"utf8"}),t=3,o=e.split(`
`),s=Math.max(i-t,0),c=Math.min(o.length,i+t)}catch(l){return r.message+=" - could not read from "+u+" ("+l.message+")",void x(r,null,i)}t=o.slice(s,c).map(function(l,p){var F=p+s+1;return(F==i?"  > ":"    ")+F+"| "+l}).join(`
`),r.path=u;try{r.message=(u||"Pug")+":"+i+`
`+t+`

`+r.message}catch{}throw r}function a0(r){var u="",i,e;try{var t=r||{};(function(o,s,c){e=1,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",c.getAccessLevel()>=o.ADMIN&&(e=2,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",u=u+'<li role="presentation">',e=3,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",u=u+'<a class="g-user-policies" role="menuitem">',e=4,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",u=u+'<i class="icon-box"></i>',e=5,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",s.get("admin")?(e=6,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",u=u+"Quota and assetstore policies"):(e=8,i="/home/circleci/project/girder/plugins/user_quota/girder_user_quota/web_client/templates/userViewPoliciesMenu.pug",u=u+"Quota"),u=u+"</a></li>")}).call(this,"AccessType"in t?t.AccessType:typeof AccessType<"u"?AccessType:void 0,"currentUser"in t?t.currentUser:typeof currentUser<"u"?currentUser:void 0,"user"in t?t.user:typeof user<"u"?user:void 0)}catch(o){x(o,i,e)}return u}const n0=girder.views.body.UserView;A(n0,a0,"user")});
//# sourceMappingURL=girder-plugin-user-quota.umd.cjs.map
