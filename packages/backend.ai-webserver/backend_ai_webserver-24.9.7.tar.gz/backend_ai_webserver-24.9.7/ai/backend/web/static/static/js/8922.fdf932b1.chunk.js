"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[8922],{91238:(e,i,n)=>{n.d(i,{A:()=>d});var l=n(72338),o=n(96141),r=n(25913),s=n(46976),a=n.n(s),t=n(55093),u=n(79569);const d=e=>{let i,{values:n=[],highlightKeyword:s}=e;return 0===n.length?null:(i=n[0]&&("string"===typeof n[0]||t.isValidElement(n[0]))?n.map((e=>({label:e,color:"blue"}))):n,(0,u.jsx)(l.A,{direction:"row",children:a().map(i,((e,n)=>a().isEmpty(e.label)?null:(0,u.jsx)(r.A,{style:a().last(i)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:a().isUndefined(s)?e.label:(0,u.jsx)(o.A,{keyword:s,children:e.label})},n)))}))}},67999:(e,i,n)=>{n.d(i,{A:()=>v});var l=n(72375),o=n(85730),r=n(5901),s=n(40806),a=n(47543),t=n(12221),u=n(46976),d=n.n(u),c=n(55093),m=n(79569);const v=e=>{var i;let{dynamicSteps:n=[1,2,4,8,16,32,64,128,256,512],units:u=["m","g","t","p"],disableAutoUnit:v=!1,min:g="0m",max:p="300p",roundStep:h,...y}=e;const[f,b]=(0,o.A)(y,{defaultValue:"0g"}),[x,_]=null===f||void 0===f?[null,null]:(0,l.E8)(f),A=(0,r.A)(_),k=_||A||u[0],[j,S]=(0,l.E8)(g),[P,N]=(0,l.E8)(p),F=(0,c.useRef)(null);return(0,c.useEffect)((()=>{if(F.current){const e=e=>{var i;const n=null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value;/^\d+(g|m)$/.test(n)&&b(n)},i=F.current;return null===i||void 0===i||i.addEventListener("input",e),()=>{null===i||void 0===i||i.removeEventListener("input",e)}}}),[F,x,_,b]),(0,m.jsx)(s.A,{ref:F,...y,onBlur:()=>{if(d().isNumber(h)&&h>0){var e,i,n;const l=(null===(e=h.toString().split(".")[1])||void 0===e?void 0:e.length)||0;if(isNaN(Math.round(d().toNumber((null===(i=F.current)||void 0===i?void 0:i.value)||"0")/h)*h))return;b(`${(Math.round(d().toNumber((null===(n=F.current)||void 0===n?void 0:n.value)||"0")/h)*h).toFixed(l)}${k}`)}},value:x,onChange:e=>{b(null===e||void 0===e?e:`${e}${k}`)},max:N===k?P:null===(i=(0,l.Is)(p,k))||void 0===i?void 0:i.number,min:S===k?j:(0,l.Is)(g,k).number,addonAfter:(0,m.jsx)(a.A,{tabIndex:-1,value:k,onChange:e=>{b(`${x}${e}`)},onDropdownVisibleChange:e=>{(e&&null===f||void 0===f)&&b(`0${k}`)},options:d().map(u,(e=>({value:e,label:(0,m.jsx)(t.A.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}))),suffixIcon:u.length>1?void 0:null,open:u.length>1&&void 0,style:{cursor:u.length>1?void 0:"default"}}),step:0,onStep:(e,i)=>{const l=d().isNull(x)||d().isUndefined(x)?0:x,o=d().sortedIndex(d().sortBy(n),l);let r;r="up"===i.type?l===n[o]?o+1:o:o-1;const s=u.indexOf(k);if(!v&&r<0)if(0===s)b(`0${k}`);else{const e=n[n.length-1],i=u[s-1];b(`${e}${i}`)}else if(!v&&r>n.length-1)if(s===u.length-1)b(`${l+("up"===i.type?1:-1)}${N}`);else{const e=n[0],i=u[s+1];b(`${e}${i}`)}else if(r>=0&&r<n.length){let e=n[r];S===k&&e<j?e=j:N===k&&e>P&&(e=P),b(`${e}${k}`)}}})}},90184:(e,i,n)=>{n.d(i,{A:()=>a});var l=n(23441),o=n(55093),r=n(79569);const s=function(e,i){let{image:n,style:o={}}=e,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const[,{getImageIcon:a}]=(0,l.Gj)();return(0,r.jsx)("img",{src:a(n),style:{width:"1em",height:"1em",...o},alt:s})},a=o.memo(s)},63515:(e,i,n)=>{n.d(i,{A:()=>m});var l=n(23441),o=n(85730),r=n(72338),s=n(40806),a=n(64179),t=n(46976),u=n.n(t),d=n(55093),c=n(79569);const m=e=>{let{min:i,max:n,step:t,disabled:m,inputNumberProps:v,sliderProps:g,...p}=e;const[h,y]=(0,o.A)(p),f=d.useRef(null);(0,d.useEffect)((()=>{1===t&&h%1!==0&&y(u().max([Math.round(h),i]))}),[t]);const[b,x]=(0,l.Tw)("first");return(0,d.useEffect)((()=>{setTimeout((()=>{x(h)}),0)}),[]),(0,c.jsxs)(r.A,{direction:"row",gap:"md",children:[(0,c.jsx)(r.A,{style:{flex:2,minWidth:190},align:"stretch",direction:"column",children:(0,c.jsx)(s.A,{ref:f,max:n,min:i,step:null!==t&&void 0!==t?t:void 0,disabled:m,value:h,onChange:y,onBlur:()=>{if(u().isNumber(t)&&t>0){var e,l,o;if(u().isNumber(n)&&n<u().toNumber((null===(e=f.current)||void 0===e?void 0:e.value)||"0"))return;const r=(null===(l=t.toString().split(".")[1])||void 0===l?void 0:l.length)||0;y(u().max([u().toNumber((Math.round(u().toNumber((null===(o=f.current)||void 0===o?void 0:o.value)||"0")/t)*t).toFixed(r)),i]))}},...v},b)}),(0,c.jsx)(r.A,{direction:"column",align:"stretch",style:{flex:3},children:(0,c.jsx)(a.A,{max:n,min:0,step:t,disabled:m,value:h,onChange:e=>{void 0!==i&&e<i||y(e)},...g,marks:u().omitBy(null===g||void 0===g?void 0:g.marks,((e,i)=>!!u().isNumber(n)&&u().parseInt(i)>n))})})]})}},59805:(e,i,n)=>{n.d(i,{t2:()=>G,jh:()=>W,Ay:()=>Z});var l,o=n(72375),r=n(23441),s=n(7971),a=n(6742),t=n(81530),u=n(68098),d=n(46594),c=n(54690),m=n(72338),v=n(42388),g=n(62976),p=n(47543),h=n(46976),y=n.n(h),f=n(55093),b=n(33364),x=n(63821),_=n(79569);const A=e=>{let{fetchKey:i,resourceGroup:o,...r}=e;const{t:s}=(0,b.Bd)(),[a,t]=(0,g.A)(r),{baiPaginationOption:u}=(0,c.w4)({current:1,pageSize:20}),{agent_summary_list:d}=(0,x.useLazyLoadQuery)(void 0!==l?l:l=n(38059),{limit:u.limit,offset:u.offset,status:"ALIVE",filter:"schedulable is true",scaling_group:o},{fetchPolicy:"network-only",fetchKey:i}),h=y().map(null===d||void 0===d?void 0:d.items,(e=>{var i,n;const l=JSON.parse(null!==(i=null===e||void 0===e?void 0:e.available_slots)&&void 0!==i?i:"{}"),o=JSON.parse(null!==(n=null===e||void 0===e?void 0:e.occupied_slots)&&void 0!==n?n:"{}"),r=y().chain(l).mapValues(((e,i)=>{var n,l;return i.endsWith(".shares")?parseFloat(e)-parseFloat(null!==(n=o[i])&&void 0!==n?n:0):parseInt(e)-parseInt(null!==(l=o[i])&&void 0!==l?l:0)})).value();return{label:(0,_.jsxs)(m.A,{direction:"row",justify:"between",children:[null===e||void 0===e?void 0:e.id,(0,_.jsx)(m.A,{direction:"row",gap:"xxs",children:y().map(r,((e,i)=>(0,_.jsx)(v.A,{type:i,value:e.toString(),hideTooltip:!0},i)))})]}),value:null===e||void 0===e?void 0:e.id}}));return(0,_.jsx)(p.A,{onChange:(e,i)=>{t(e,i)},...r,value:a,options:[{label:s("session.launcher.autoSelect"),value:"auto"},...h]})};var k=n(22407),j=n(85730),S=n(67999),P=n(66596),N=n(64179);const F=e=>{let{min:i="0m",max:n="32g",warn:l,units:s=["m","g"],extraMarks:a,hideSlider:t,step:u=.05,...d}=e;const[c,v]=(0,j.A)(d,{defaultValue:"0g"}),{token:g}=P.A.useToken(),p=(0,f.useMemo)((()=>(0,o.Is)(i,"g",2)),[i]),h=(0,f.useMemo)((()=>(0,o.Is)(n,"g",2)),[n]),b=(0,f.useMemo)((()=>(0,o.Is)(c||"0g","g",2)),[c]),[x,A]=(0,r.Tw)("first");(0,f.useEffect)((()=>{setTimeout((()=>{A(null===c||void 0===c?void 0:c.toString())}),0)}),[]);const k=y().isNumber(null===p||void 0===p?void 0:p.number)&&y().isNumber(null===h||void 0===h?void 0:h.number)&&(null===p||void 0===p?void 0:p.number)>(null===h||void 0===h?void 0:h.number);return(0,_.jsxs)(m.A,{direction:"row",gap:"md",children:[(0,_.jsx)(m.A,{style:{flex:2,minWidth:190},direction:"column",align:"stretch",children:(0,f.createElement)(S.A,{...d,key:x,min:i,max:n,units:s,value:c,onChange:e=>{v(e)},style:{minWidth:130},roundStep:u,changeOnBlur:!k})}),(0,_.jsx)(m.A,{direction:"column",align:"stretch",style:{flex:3,...t&&{visibility:"hidden",height:0}},children:(0,_.jsx)(m.A,{direction:"column",align:"stretch",children:(0,_.jsx)(N.A,{max:null===h||void 0===h?void 0:h.number,styles:{track:l&&{backgroundColor:(0,o.Mh)(l,c||"0b")<0?g.colorWarning:void 0}||void 0,rail:{}},step:u,value:k?0:null===b||void 0===b?void 0:b.number,disabled:k,tooltip:{formatter:k?null:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?`${(1024*e).toFixed(2)} MiB`:`${e.toFixed(2)} GiB`}},onChange:e=>{null!==p&&void 0!==p&&p.number&&p.number>e?v(i):v(e<1?1024*e+"m":`${e}g`)},marks:(F={...p&&y().isNumber(null===p||void 0===p?void 0:p.number)&&{[p.number]:{style:{color:g.colorTextSecondary},label:0===p.number?p.number:p.number>=1?p.number+"g":1024*p.number+"m"}},...y().omitBy(a,((e,i)=>!!y().isNumber(null===h||void 0===h?void 0:h.number)&&y().parseInt(i)>(null===h||void 0===h?void 0:h.number))),...(null===h||void 0===h?void 0:h.number)&&{[h.number]:{style:{color:g.colorTextSecondary},label:0===h.number?h.number:h.number>=1?h.number+"g":1024*h.number+"m"}}},y().omitBy({...F},((e,i)=>{const n=parseFloat(i);return p&&h&&((null===p||void 0===p?void 0:p.number)>n||(null===h||void 0===h?void 0:h.number)<n)})))})})})]});var F};var I,w=n(63515),V=n(87258),C=n(5503),K=n(4097),M=n(80056),E=n(2556);const T=e=>{let{allocatablePresetNames:i,showCustom:l,showMinimumRequired:a,...t}=e;const[u,d]=(0,r.Tw)("first"),{run:c}=(0,M.A)(d,{wait:3e3,trailing:!1,leading:!0}),[g]=(0,s.bL)(),{t:h}=(0,b.Bd)(),{token:A}=P.A.useToken(),[k,S]=(0,f.useTransition)(),[N,F]=(0,j.A)(t),{resource_presets:w}=(0,x.useLazyLoadQuery)(void 0!==I?I:I=n(2993),{},{fetchKey:u,fetchPolicy:"first"===u?"store-and-network":"network-only"});return(0,_.jsx)(p.A,{loading:k,options:[...l?[{value:"custom",label:(0,_.jsxs)(m.A,{gap:"xs",style:{display:"inline-flex"},children:[(0,_.jsx)(C.A,{})," ",h("session.launcher.CustomAllocation")]}),selectedLabel:h("session.launcher.CustomAllocation")}]:[],...a?[{value:"minimum-required",label:(0,_.jsxs)(m.A,{gap:"xs",children:[h("session.launcher.MiniumAllocation"),(0,_.jsx)(E.A,{title:h("session.launcher.MiniumAllocationTooltip"),children:(0,_.jsx)(K.A,{style:{color:A.colorTextSecondary}})})]}),selectedLabel:h("session.launcher.MiniumAllocation")}]:[],{label:"Preset",options:y().map(w,((e,n)=>{const l=JSON.parse((null===e||void 0===e?void 0:e.resource_slots)||"{}"),o=i?!i.includes((null===e||void 0===e?void 0:e.name)||""):void 0;return{value:null===e||void 0===e?void 0:e.name,label:(0,_.jsxs)(m.A,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,_.jsx)(m.A,{direction:"row",gap:"xxs",style:{},children:y().map(y().omitBy(l,((e,i)=>y().isEmpty(g[i]))),((e,i)=>(0,_.jsx)(v.A,{type:i,value:e,hideTooltip:!0},i)))})]}),preset:e,disabled:o}})).sort(((e,i)=>e.disabled===i.disabled?0:e.disabled?1:-1)).sort(((e,i)=>(0,o._f)(e.value,i.value)))}],showSearch:!0,...t,value:N,onChange:F,optionLabelProp:y().includes(["custom","minimum-required"],N)?"selectedLabel":"label",onDropdownVisibleChange:e=>{t.onDropdownVisibleChange&&t.onDropdownVisibleChange(e),e&&S((()=>{c()}))}})};var R=n(99159),q=n(48124),$=n(79597),L=n(80963),z=n(47149),B=n(91043),D=n(92047),U=n(38926),Q=n(63340),O=n(84039);const G="64m",W={resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1,enabledAutomaticShmem:!0,agent:"auto"},X=(e,i)=>e>=i,H=e=>{let{enableAgentSelect:i=!1,enableNumOfSessions:n,enableResourcePresets:l,forceImageMinValues:c=!1,showRemainingWarning:v=!1}=e;const g=$.A.useFormInstance(),{t:p}=(0,b.Bd)(),{token:h}=P.A.useToken(),x=(0,r.CX)(),[{keypairResourcePolicy:j,sessionLimitAndRemaining:S}]=(0,a.y)(),[N,I]=(0,r.Tw)("first"),[C,K]=(0,f.useTransition)(),M=(0,t.hd)(),E=$.A.useWatch(["resourceGroup"],{form:g,preserve:!0})||g.getFieldValue("resourceGroup"),q=$.A.useWatch(["environments","image"],{form:g,preserve:!0}),W=$.A.useWatch(["allocationPreset"],{form:g,preserve:!0}),[{currentImageMinM:H,remaining:Z,resourceLimits:ee,checkPresetInfo:ie}]=(0,d.y)({currentProjectName:M.name,currentResourceGroup:E||void 0,currentImage:q}),{mergedResourceSlots:ne,resourceSlotsInRG:le}=(0,s.Hv)(E||void 0),oe=y().omitBy(le,((e,i)=>{var n,l;return!!["cpu","mem","shmem"].includes(i)||(null===(n=ee.accelerators[i])||void 0===n||!n.max||0===(null===(l=ee.accelerators[i])||void 0===l?void 0:l.max))})),re=(0,f.useMemo)((()=>y().filter(null===q||void 0===q?void 0:q.resource_limits,(e=>!!e&&!y().includes(["cpu","mem","shmem"],e.key)))),[null===q||void 0===q?void 0:q.resource_limits]),se={min:1,max:S.max,remaining:S.remaining},ae=(0,f.useMemo)((()=>Y(null===ie||void 0===ie?void 0:ie.presets,ee,q)),[null===ie||void 0===ie?void 0:ie.presets,ee,q]),te=(0,u.E)((()=>{const e=g.getFieldValue(["resource","acceleratorType"]),i=oe[e]?e:y().keys(oe)[0];g.setFieldsValue({resource:{acceleratorType:i||e}})})),ue=(0,u.E)((()=>{if(y().includes(["custom","minimum-required"],g.getFieldValue("allocationPreset")));else if(ae.includes(g.getFieldValue("allocationPreset")));else if(l&&ae[0]){const e=y().sortBy(ae)[0];g.setFieldsValue({allocationPreset:e}),ce(e)}else g.setFieldsValue({allocationPreset:"custom"});te(),g.validateFields(["resource"],{recursive:!0}).catch((()=>{}))}));(0,f.useEffect)((()=>{"auto-select"===W&&E&&ue()}),[E,ue,W]),(0,f.useEffect)((()=>{E&&ue()}),[E,ue,q]);const de=e=>{var i,n,l,r,s,a;const t={cpu:null===(i=ee.cpu)||void 0===i?void 0:i.min,mem:(null===(n=(0,o.Is)(((null===(l=(0,o.Is)(null===(r=ee.shmem)||void 0===r?void 0:r.min,"m"))||void 0===l?void 0:l.number)||0)+((null===(s=(0,o.Is)(null===(a=ee.mem)||void 0===a?void 0:a.min,"m"))||void 0===s?void 0:s.number)||0)+"m","g"))||void 0===n?void 0:n.number)+"g"};if(re.length>0)if(y().find(re,(e=>(null===e||void 0===e?void 0:e.key)===g.getFieldValue(["resource","acceleratorType"])))){var u;t.acceleratorType=g.getFieldValue(["resource","acceleratorType"]),t.accelerator=null===(u=ee.accelerators[g.getFieldValue(["resource","acceleratorType"])])||void 0===u?void 0:u.min}else{var d;const e=null===(d=y().filter(re,(e=>y().keys(le).includes(null===e||void 0===e?void 0:e.key)))[0])||void 0===d?void 0:d.key;var m;if(e)t.accelerator=null===(m=ee.accelerators[e])||void 0===m?void 0:m.min,t.acceleratorType=e}else t.accelerator=0;c||e||(["cpu","accelerator"].forEach((e=>{const i=t[e];y().isNumber(i)&&i<g.getFieldValue(["resource",e])&&delete t[e]})),["mem","shmem"].forEach((e=>{const i=t[e];y().isString(i)&&(0,o.Mh)(i,g.getFieldValue(["resource",e]))<0&&delete t[e]}))),g.setFieldsValue({resource:{...t}}),q&&0===re.length&&g.setFieldValue(["resource","accelerator"],0),g.getFieldValue("enabledAutomaticShmem")&&me(g.getFieldValue(["resource","mem"])||"0g"),g.validateFields(["resource"],{recursive:!0}).catch((()=>{}))};(0,f.useEffect)((()=>{de()}),[q]);const ce=e=>{var i,n;const l=y().find(null===ie||void 0===ie?void 0:ie.presets,(i=>i.name===e)),r=y().pick(null===l||void 0===l?void 0:l.resource_slots,y().keys(le)),s=null===(i=(0,o.Is)(((null===r||void 0===r?void 0:r.mem)||0)+"b","g",2))||void 0===i?void 0:i.numberUnit,a=y().omit(r,["cpu","mem","shmem"]),t=y().find(y().keys(oe),(e=>void 0!==a[e]));let u={accelerator:0};t&&(u={acceleratorType:t,accelerator:Number(a[t]||0)}),g.setFieldsValue({resource:{...u,mem:s,shmem:null===(n=(0,o.Is)(((null===l||void 0===l?void 0:l.shared_memory)||0)+"b","g",2))||void 0===n?void 0:n.numberUnit,cpu:parseInt((null===r||void 0===r?void 0:r.cpu)||"0")||0}}),me(s||"0g"),g.validateFields(["resource"],{recursive:!0}).catch((()=>{}))},me=e=>{(0,o.Mh)(e,"4g")>=0&&(0,o.Mh)(e,(0,o.sL)(H,"1g")||"0b")>=0&&(0,o.Mh)("1g",G)>0?g.setFieldValue(["resource","shmem"],"1g"):g.setFieldValue(["resource","shmem"],G)};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)($.A.Item,{name:"resourceGroup",label:p("session.ResourceGroup"),rules:[{required:!0}],children:(0,_.jsx)(V.A,{projectName:M.name,showSearch:!0})}),l?(0,_.jsx)($.A.Item,{label:p("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:h.marginXS},children:(0,_.jsx)(T,{showCustom:x._config.allowCustomResourceAllocation,showMinimumRequired:x._config.allowCustomResourceAllocation,onChange:(e,i)=>{switch(e){case"custom":break;case"minimum-required":g.setFieldValue("enabledAutomaticShmem",!0),de(!0);break;default:g.setFieldValue("enabledAutomaticShmem",!0),ce(e)}},allocatablePresetNames:ae})}):null,(0,_.jsx)(L.A,{style:{marginBottom:h.margin,display:x._config.allowCustomResourceAllocation?"block":"none"},children:(0,_.jsx)($.A.Item,{shouldUpdate:(e,i)=>e.allocationPreset!==i.allocationPreset,noStyle:!0,children:e=>{var i,n,l,r,s,a,t,u,d,c,f,x;let{getFieldValue:A}=e;return(0,_.jsxs)(_.Fragment,{children:[(null===le||void 0===le?void 0:le.cpu)&&(0,_.jsx)($.A.Item,{name:["resource","cpu"],label:(null===ne||void 0===ne||null===(i=ne.cpu)||void 0===i?void 0:i.human_readable_name)||"CPU",tooltip:{placement:"right",title:(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescCPU"})},required:!0,rules:[{required:!0},{type:"number",min:null===(n=ee.cpu)||void 0===n?void 0:n.min},{type:"number",max:null===(l=ee.cpu)||void 0===l?void 0:l.max},{warningOnly:!0,validator:async(e,i)=>{var n,l,o,r;return y().isNumber(null===(n=ee.cpu)||void 0===n?void 0:n.min)&&y().isNumber(null===(l=ee.cpu)||void 0===l?void 0:l.max)&&X(null===(o=ee.cpu)||void 0===o?void 0:o.min,null===(r=ee.cpu)||void 0===r?void 0:r.max)?Promise.reject(p("session.launcher.InsufficientAllocationOfResourcesWarning")):v&&y().isNumber(Z.cpu)&&i>Z.cpu?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}}],children:(0,_.jsx)(w.A,{inputNumberProps:{addonAfter:(null===ne||void 0===ne||null===(r=ne.cpu)||void 0===r?void 0:r.display_unit)||p("session.launcher.Core")},sliderProps:{marks:{...Z.cpu?{[Z.cpu]:{label:(0,_.jsx)(J,{})}}:{},...null!==(s=ee.cpu)&&void 0!==s&&s.min?{[null===(a=ee.cpu)||void 0===a?void 0:a.min]:null===(t=ee.cpu)||void 0===t?void 0:t.min}:{},...null!==(u=ee.cpu)&&void 0!==u&&u.max?{[null===(d=ee.cpu)||void 0===d?void 0:d.max]:{style:{color:h.colorTextSecondary},label:null===(c=ee.cpu)||void 0===c?void 0:c.max}}:{}}},min:null===(f=ee.cpu)||void 0===f?void 0:f.min,max:null===(x=ee.cpu)||void 0===x?void 0:x.max,step:1,onChange:()=>{g.setFieldValue("allocationPreset","custom")}})}),(null===le||void 0===le?void 0:le.mem)&&(0,_.jsxs)($.A.Item,{label:p("session.launcher.Memory"),tooltip:{placement:"right",props:{onClick:e=>e.preventDefault()},title:(0,_.jsx)(m.A,{direction:"column",onClick:e=>e.preventDefault(),children:(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescMemory"})})},required:!0,children:[(0,_.jsx)($.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.resource.shmem!==i.resource.shmem,children:()=>{var e,i,n;return(0,_.jsx)($.A.Item,{name:["resource","mem"],noStyle:!0,rules:[{required:!0},{validator:async(e,i)=>{var n,l,r;return y().isString(i)&&null!==(n=ee.mem)&&void 0!==n&&n.max&&(0,o.Mh)(i,null===(l=ee.mem)||void 0===l?void 0:l.max)>0?Promise.reject(p("general.MaxValueNotification",{name:p("session.launcher.Memory"),max:y().toUpper((null===(r=ee.mem)||void 0===r?void 0:r.max)||"0g")+"iB"})):Promise.resolve()}},{validator:async(e,i)=>{var n,l,r;return!y().isElement(i)&&null!==(n=ee.mem)&&void 0!==n&&n.min&&(0,o.Mh)(i,(null===(l=ee.mem)||void 0===l?void 0:l.min)||"0g")<0?Promise.reject(p("session.launcher.MinMemory",{size:y().toUpper((null===(r=ee.mem)||void 0===r?void 0:r.min)||"0g")})):Promise.resolve()}},{warningOnly:!0,validator:async(e,i)=>{var n,l;return(0,o.Mh)(null===(n=ee.mem)||void 0===n?void 0:n.min,null===(l=ee.mem)||void 0===l?void 0:l.max)>0?Promise.reject(p("session.launcher.InsufficientAllocationOfResourcesWarning")):v&&!y().isElement(i)&&ee.mem&&(0,o.Mh)(i,Z.mem+"b")>0?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}}],children:(0,_.jsx)(F,{max:null===(e=ee.mem)||void 0===e?void 0:e.max,min:null===(i=ee.mem)||void 0===i?void 0:i.min,addonBefore:"MEM",extraMarks:{...Z.mem?{[null===(n=(0,o.Is)(Z.mem+"b","g",3))||void 0===n?void 0:n.numberFixed]:{label:(0,_.jsx)(J,{})}}:{}},onChange:e=>{e&&g.getFieldValue("enabledAutomaticShmem")&&(me(e),g.setFieldValue("allocationPreset","custom"))}})})}}),(0,_.jsxs)(m.A,{direction:"column",gap:"xxs",align:"start",children:[(0,_.jsxs)(m.A,{direction:"row",gap:"xs",children:[p("session.launcher.EnableAutomaticMiniumShmem")," ",(0,_.jsx)($.A.Item,{noStyle:!0,name:"enabledAutomaticShmem",valuePropName:"checked",children:(0,_.jsx)(z.A,{size:"small",onChange:e=>{e&&me(g.getFieldValue(["resource","mem"])||"0g"),g.setFieldValue("allocationPreset","custom")}})})]}),(0,_.jsx)($.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.resource.mem!==i.resource.mem||e.enabledAutomaticShmem!==i.enabledAutomaticShmem,children:()=>{var e;return(0,_.jsx)($.A.Item,{noStyle:!0,name:["resource","shmem"],hidden:g.getFieldValue("enabledAutomaticShmem"),tooltip:(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:async(e,i)=>{var n,l;if(y().isEmpty(null===(n=A("resource"))||void 0===n?void 0:n.mem)||y().isEmpty(i)||(0,o.Mh)(null===(l=A("resource"))||void 0===l?void 0:l.mem,i)>=0)return Promise.resolve();throw p("resourcePreset.SHMEMShouldBeSmallerThanMemory")}}],children:(0,_.jsx)(F,{min:null===(e=ee.shmem)||void 0===e?void 0:e.min,addonBefore:"SHM",max:g.getFieldValue(["resource","mem"])||"0g",hideSlider:!0,onChange:()=>{g.setFieldValue("allocationPreset","custom")}})})}})]})]}),(0,_.jsx)($.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>{var n,l;return(null===(n=e.resource)||void 0===n?void 0:n.acceleratorType)!==(null===(l=i.resource)||void 0===l?void 0:l.acceleratorType)||e.cluster_size!==i.cluster_size},children:e=>{var i,n,l,o,r,s;let{getFieldValue:a}=e;const t=a(["resource","acceleratorType"]),u=y().isEmpty(oe)||0===re.length&&y().isEmpty(g.getFieldValue(["environments","manual"]));return(0,_.jsx)($.A.Item,{name:["resource","accelerator"],label:p("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescAIAccelerator"})},rules:[{required:re.length>0},{type:"number",min:(null===(i=ee.accelerators[t])||void 0===i?void 0:i.min)||0,max:null===(n=ee.accelerators[t])||void 0===n?void 0:n.max},{validator:async(e,i)=>y().endsWith(t,"shares")&&g.getFieldValue("cluster_size")>=2&&i%1!==0?Promise.reject(p("session.launcher.OnlyAllowsDiscreteNumberByClusterSize")):Promise.resolve()},{warningOnly:!0,validator:async(e,i)=>{var n,l,o,r;return y().isNumber(null===(n=ee.accelerators[t])||void 0===n?void 0:n.min)&&y().isNumber(null===(l=ee.accelerators[t])||void 0===l?void 0:l.max)&&X(null===(o=ee.accelerators[t])||void 0===o?void 0:o.min,null===(r=ee.accelerators[t])||void 0===r?void 0:r.max)?Promise.reject(p("session.launcher.InsufficientAllocationOfResourcesWarning")):v&&y().isNumber(Z.accelerators[t])&&i>Z.accelerators[t]?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}}],children:(0,_.jsx)(w.A,{sliderProps:{marks:{0:0,...Z.accelerators[t]?{[Z.accelerators[t]]:{label:(0,_.jsx)(J,{})}}:{},...y().isNumber(null===(l=ee.accelerators[t])||void 0===l?void 0:l.max)?{[null===(o=ee.accelerators[t])||void 0===o?void 0:o.max]:null===(r=ee.accelerators[t])||void 0===r?void 0:r.max}:{}},tooltip:{formatter:function(){var e;return`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:0} ${(null===ne||void 0===ne||null===(e=ne[t])||void 0===e?void 0:e.display_unit)||""}`},open:!(re.length<=0)&&void 0}},disabled:u,min:0,max:null===(s=ee.accelerators[t])||void 0===s?void 0:s.max,step:y().endsWith(t,"shares")&&g.getFieldValue("cluster_size")<2?.1:1,onChange:()=>{g.setFieldValue("allocationPreset","custom")},inputNumberProps:{addonAfter:(0,_.jsx)($.A.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:y().keys(oe)[0],hidden:u,children:(0,_.jsx)(k.A,{autoSelectOption:!0,tabIndex:-1,suffixIcon:y().size(oe)>1?void 0:null,popupMatchSelectWidth:!1,options:y().map(oe,((e,i)=>{var n;return{value:i,label:(null===ne||void 0===ne||null===(n=ne[i])||void 0===n?void 0:n.display_unit)||"UNIT",disabled:re.length>0&&!y().find(re,(e=>(null===e||void 0===e?void 0:e.key)===i))}}))})})}})})}})]})}})}),n?(0,_.jsx)(L.A,{style:{marginBottom:h.margin},children:(0,_.jsx)($.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.cluster_size!==i.cluster_size,children:()=>(0,_.jsx)($.A.Item,{name:["num_of_sessions"],label:p("webui.menu.Sessions"),tooltip:(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},{warningOnly:!0,validator:async(e,i)=>v&&se&&i>se.remaining?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}],children:(0,_.jsx)(w.A,{inputNumberProps:{addonAfter:"#"},disabled:g.getFieldValue("cluster_size")>1,sliderProps:{marks:{[null===se||void 0===se?void 0:se.min]:null===se||void 0===se?void 0:se.min,...null!==se&&void 0!==se&&se.remaining?{[null===se||void 0===se?void 0:se.remaining]:{label:(0,_.jsx)(J,{})}}:{},[null===se||void 0===se?void 0:se.max]:null===se||void 0===se?void 0:se.max}},min:null===se||void 0===se?void 0:se.min,max:null===se||void 0===se?void 0:se.max})})})}):null,i&&(0,_.jsx)($.A.Item,{label:p("session.launcher.SelectAgent"),required:!0,tooltip:(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescSelectAgent"}),children:(0,_.jsxs)(m.A,{gap:"xs",children:[(0,_.jsx)(f.Suspense,{children:(0,_.jsx)($.A.Item,{required:!0,noStyle:!0,style:{flex:1},name:"agent",children:(0,_.jsx)(A,{resourceGroup:E,fetchKey:N,onChange:(e,i)=>{"auto"!==e&&g.setFieldsValue({cluster_mode:"single-node",cluster_size:1})}})})}),(0,_.jsx)($.A.Item,{noStyle:!0,children:(0,_.jsx)(B.Ay,{loading:C,onClick:()=>{K((()=>I()))},icon:(0,_.jsx)(R.A,{})})})]})}),x.supports("multi-container")&&(0,_.jsx)($.A.Item,{label:p("session.launcher.ClusterMode"),tooltip:(0,_.jsxs)(m.A,{direction:"column",align:"start",children:[p("session.launcher.SingleNode"),(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescSingleNode"}),(0,_.jsx)(D.A,{style:{backgroundColor:h.colorBorder}}),p("session.launcher.MultiNode"),(0,_.jsx)(b.x6,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,dependencies:["agent"],children:e=>{let{getFieldValue:i}=e;return(0,_.jsx)(L.A,{style:{marginBottom:h.margin},children:(0,_.jsxs)(U.A,{gutter:h.marginMD,children:[(0,_.jsx)(Q.A,{xs:24,children:(0,_.jsx)($.A.Item,{name:"cluster_mode",required:!0,children:(0,_.jsxs)(O.Ay.Group,{onChange:e=>{g.validateFields().catch((()=>{}))},disabled:"auto"!==i("agent"),children:[(0,_.jsx)(O.Ay.Button,{value:"single-node",children:p("session.launcher.SingleNode")}),(0,_.jsx)(O.Ay.Button,{value:"multi-node",children:p("session.launcher.MultiNode")})]})})}),(0,_.jsx)(Q.A,{xs:24,children:(0,_.jsx)($.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.cluster_mode!==i.cluster_mode,children:()=>{var e;const n=y().min([null===(e=ee.cpu)||void 0===e?void 0:e.max,j.max_containers_per_session]),l="single-node"===g.getFieldValue("cluster_mode")?p("session.launcher.Container"):p("session.launcher.Node");return(0,_.jsx)($.A.Item,{name:"cluster_size",label:p("session.launcher.ClusterSize"),required:!0,rules:[{warningOnly:!0,validator:async(e,i)=>{if(v){const e=y().min([Z.cpu,j.max_containers_per_session]);if(y().isNumber(e)&&i>e)return Promise.reject(p("session.launcher.EnqueueComputeSessionWarning"))}return Promise.resolve()}}],children:(0,_.jsx)(w.A,{min:1,step:1,max:y().isNumber(n)?n:void 0,disabled:1===n||"auto"!==i("agent"),sliderProps:{marks:{1:"1",...Z.cpu?{[Z.cpu]:{label:(0,_.jsx)(J,{})}}:{},...y().isNumber(n)?{[n]:n}:{}},tooltip:{formatter:function(){return`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:0} ${l}`}}},inputNumberProps:{addonAfter:l},onChange:e=>{e>1&&g.setFieldValue("num_of_sessions",1)}})})}})})]})})}})]})},J=()=>{const{token:e}=P.A.useToken();return(0,_.jsx)(m.A,{style:{position:"absolute",top:-24,transform:"translateX(-50%)",color:e.colorSuccess,opacity:.5},children:(0,_.jsx)(q.A,{})})},Z=f.memo(H),Y=(e,i,n)=>{const l=y().filter(null===n||void 0===n?void 0:n.resource_limits,(e=>!!e&&!y().includes(["cpu","mem","shmem"],e.key))),r=y().filter(e,(e=>y().every(e.resource_slots,((n,l)=>{if("mem"===l){var r,s,a;return!!("string"!==typeof(null===(r=i[l])||void 0===r?void 0:r.max))||"string"===typeof e.resource_slots[l]&&"string"===typeof(null===(s=i[l])||void 0===s?void 0:s.max)&&(0,o.Mh)(e.resource_slots[l],null===(a=i[l])||void 0===a?void 0:a.max)<=0}if("shmem"===l)return!0;if("cpu"===l){var t,u;return!!y().isNaN(y().toNumber(null===(t=i[l])||void 0===t?void 0:t.max))||(y().toNumber(e.resource_slots[l])||0)<=y().toNumber(null===(u=i[l])||void 0===u?void 0:u.max)}var d,c;return!!y().isNaN(y().toNumber(null===(d=i.accelerators[l])||void 0===d?void 0:d.max))||(y().toNumber(e.resource_slots[l])||0)<=y().toNumber(null===(c=i.accelerators[l])||void 0===c?void 0:c.max)})))).map((e=>e.name)),s=y().filter(e,(e=>{const i=y().omitBy(e.resource_slots,((e,i)=>{if(["mem","cpu","shmem"].includes(i))return!0}));return 0===l.length?!!y().isEmpty(i):y().some(l,(e=>(null===e||void 0===e?void 0:e.key)&&i[null===e||void 0===e?void 0:e.key]&&y().toNumber(i[null===e||void 0===e?void 0:e.key])>=y().toNumber(null===e||void 0===e?void 0:e.min)))})).map((e=>e.name));return 0===l.length?r:y().intersection(r,s)}},87258:(e,i,n)=>{n.d(i,{A:()=>v});var l=n(72375),o=n(23441),r=n(69949),s=n(85730),a=n(96141),t=n(47543),u=n(46976),d=n.n(u),c=n(55093),m=n(79569);const v=e=>{let{projectName:i,autoSelectDefault:n,filter:u,searchValue:v,onSearch:g,loading:p,...h}=e;const y=(0,l.QE)(),[f]=(0,o.Tw)("first"),[b,x]=(0,s.A)({value:v,onChange:g}),[_,A]=(0,s.A)(h),[k,j]=(0,c.useTransition)(),S=c.useCallback((function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),l=1;l<i;l++)n[l-1]=arguments[l];j((()=>{A(e,...n)}))}),[j,A]),{data:P}=(0,r.nj)({queryKey:["ResourceGroupSelectQuery",i],queryFn:()=>{const e=new URLSearchParams;return e.set("group",i),Promise.all([y({method:"GET",url:`/scaling-groups?${e.toString()}`}),y({method:"GET",url:"/folders/_/hosts"})])},staleTime:0,fetchKey:f}),N=d().flatMap(null===P||void 0===P?void 0:P[1].volume_info,(e=>{var i;return null!==(i=null===e||void 0===e?void 0:e.sftp_scaling_groups)&&void 0!==i?i:[]})),F=d().filter(null===P||void 0===P?void 0:P[0].scaling_groups,(e=>!d().includes(N,e.name)&&(!u||u(e.name))));(0,c.useEffect)((()=>{_&&!d().some(F,(e=>e.name===_))&&S(void 0)}),[F,_,S]);const I=d().find(F,(e=>"default"===e.name))||F[0],w=I?{label:I.name,value:I.name}:void 0;(0,c.useEffect)((()=>{n&&w&&w.value!==h.value&&S(w.value,w)}),[n]);const V=h.showSearch?{onSearch:x,searchValue:b,showSearch:!0}:{};return(0,m.jsx)(t.A,{defaultActiveFirstOption:!0,...V,defaultValue:n?w:void 0,loading:p||k,disabled:k,options:d().map(F,(e=>({value:e.name,label:e.name}))),optionRender:e=>{var i;return(0,m.jsx)(a.A,{keyword:b,children:null===(i=e.data.value)||void 0===i?void 0:i.toString()})},...h,value:_,onChange:S})}},42388:(e,i,n)=>{n.d(i,{A:()=>f,s:()=>y});var l=n(72375),o=n(7971),r=n(81530),s=n(72338),a=n(66596),t=n(12221),u=n(2556),d=n(46976),c=n.n(d),m=n(10709),v=n(55093),g=n(79569);const p=e=>{var i,n;let{type:u,value:d,extra:m,opts:v,hideTooltip:p=!1,max:h}=e;const{token:f}=a.A.useToken(),b=(0,r.Nw)(),{mergedResourceSlots:x}=(0,o.Hv)(b||void 0),_=e=>{var i,n,o;return null!==x&&void 0!==x&&null!==(i=x[u])&&void 0!==i&&i.number_format.binary?Number(null===(n=(0,l.Is)(e,"g",3,!0))||void 0===n?void 0:n.numberFixed).toString():((null===x||void 0===x||null===(o=x[u])||void 0===o?void 0:o.number_format.round_length)||0)>0?parseFloat(e).toFixed(2):e};return(0,g.jsxs)(s.A,{direction:"row",gap:"xxs",children:[null!==x&&void 0!==x&&x[u]?(0,g.jsx)(y,{type:u,showTooltip:!p}):u,(0,g.jsxs)(t.A.Text,{children:[_(d),c().isUndefined(h)?null:"Infinity"===h?"~\u221e":`~${_(h)}`]}),(0,g.jsx)(t.A.Text,{type:"secondary",children:(null===x||void 0===x||null===(i=x[u])||void 0===i?void 0:i.display_unit)||""}),"mem"===u&&null!==v&&void 0!==v&&v.shmem&&(null===v||void 0===v?void 0:v.shmem)>0?(0,g.jsxs)(t.A.Text,{type:"secondary",style:{fontSize:f.fontSizeSM},children:["(SHM:"," ",null===(n=(0,l.Is)(v.shmem+"b","g",2,!0))||void 0===n?void 0:n.numberFixed,"GiB)"]}):null,m]})},h=e=>{let{size:i=16,children:n}=e;return(0,g.jsx)("mwc-icon",{style:{"--mdc-icon-size":`${i+2}px`,width:i,height:i},children:n})},y=e=>{var i,n;let{type:l,size:r=16,showIcon:a=!0,showUnit:t=!0,showTooltip:d=!0,...c}=e;const v={cpu:(0,g.jsx)(h,{size:r,children:"developer_board"}),mem:(0,g.jsx)(h,{size:r,children:"memory"}),"cuda.device":"/resources/icons/file_type_cuda.svg","cuda.shares":"/resources/icons/file_type_cuda.svg","rocm.device":"/resources/icons/rocm.svg","tpu.device":(0,g.jsx)(h,{size:r,children:"view_module"}),"ipu.device":(0,g.jsx)(h,{size:r,children:"view_module"}),"atom.device":"/resources/icons/rebel.svg","atom-plus.device":"/resources/icons/rebel.svg","gaudi2.device":"/resources/icons/gaudi.svg","warboy.device":"/resources/icons/furiosa.svg","rngd.device":"/resources/icons/furiosa.svg","hyperaccel-lpu.device":"/resources/icons/npu_generic.svg"},p=null!==(i=v[l])&&void 0!==i?i:(0,g.jsx)(m.A,{}),{mergedResourceSlots:y}=(0,o.Hv)(),f="string"===typeof p?(0,g.jsx)("img",{...c,style:{height:r,alignSelf:"center",...c.style||{}},src:v[l]||"",alt:l}):(0,g.jsx)(s.A,{style:{width:16,height:16},children:p||l});return d?(0,g.jsx)(u.A,{title:(null===(n=y[l])||void 0===n?void 0:n.description)||l,children:f}):(0,g.jsx)(s.A,{style:{pointerEvents:"none"},children:f})},f=v.memo(p)},38059:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},i={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"scaling_group"},o={defaultValue:null,kind:"LocalArgument",name:"status"},r=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"scaling_group",variableName:"scaling_group"},{kind:"Variable",name:"status",variableName:"status"}],concreteType:"AgentSummaryList",kind:"LinkedField",name:"agent_summary_list",plural:!1,selections:[{alias:null,args:null,concreteType:"AgentSummary",kind:"LinkedField",name:"items",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"schedulable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"available_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,i,n,l,o],kind:"Fragment",metadata:null,name:"AgentSelectQuery",selections:r,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,n,o,e,l],kind:"Operation",name:"AgentSelectQuery",selections:r},params:{cacheID:"57b0881c2a4e4ba1bdeceb88d9ec41bd",id:null,metadata:{},name:"AgentSelectQuery",operationKind:"query",text:"query AgentSelectQuery(\n  $limit: Int!\n  $offset: Int!\n  $status: String\n  $filter: String\n  $scaling_group: String\n) {\n  agent_summary_list(limit: $limit, offset: $offset, status: $status, filter: $filter, scaling_group: $scaling_group) {\n    items {\n      id\n      status\n      schedulable\n      available_slots\n      occupied_slots\n      architecture\n    }\n    total_count\n  }\n}\n"}}}();l.hash="a3558359a8ee951a4caa89c783133e85";const o=l},2993:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();l.hash="9841642e96d89476c2848bfb093ed9c5";const o=l},13765:(e,i,n)=>{n.d(i,{o:()=>l,z:()=>o});const l=1e6,o=1e6},65509:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],i=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:i},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();l.hash="d8f5c91f0fc46a3366f57566ab688d81";const o=l},54107:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],i=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:i},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();l.hash="f3f7364c63aefe9b03111b584c48c103";const o=l},6742:(e,i,n)=>{n.d(i,{x:()=>c,y:()=>m});var l,o,r=n(23441),s=n(13765),a=n(46976),t=n.n(a),u=n(55093),d=n(63821);const c=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"};const[o,s]=(0,r.Tw)("first"),{keypair:a}=(0,d.useLazyLoadQuery)(void 0!==l?l:l=n(65509),{accessKey:e},{...i,fetchKey:o+i.fetchKey});return[a,{refresh:(0,u.useCallback)((()=>{s()}),[s])}]},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"};const[i,l]=(0,r.Tw)("first"),a=(0,r.CX)(),[m]=c(null===a||void 0===a?void 0:a._config.accessKey),{keypair_resource_policy:v}=(0,d.useLazyLoadQuery)(void 0!==o?o:o=n(54107),{name:(null===m||void 0===m?void 0:m.resource_policy)||""},{...e,fetchKey:i+e.fetchKey}),g=(0,u.useCallback)((()=>{l()}),[l]);return[{keypairResourcePolicy:v||{},keypair:m||{},sessionLimitAndRemaining:{max:t().min([(v||{}).max_concurrent_sessions||s.z,3]),remaining:((v||{}).max_concurrent_sessions||3)-((m||{}).concurrency_used||0)}},{refresh:g}]}},54690:(e,i,n)=>{n.d(i,{w4:()=>s});var l=n(46976),o=n.n(l),r=n(55093);n(63821),n(2647);const s=e=>{const[i,n]=(0,r.useState)(e);return{baiPaginationOption:{limit:i.pageSize,offset:i.current>1?(i.current-1)*i.pageSize:0},tablePaginationOption:{pageSize:i.pageSize,current:i.current},setTablePaginationOption:e=>{o().isEqual(e,i)||n((i=>({...i,...e})))}}}},46594:(e,i,n)=>{n.d(i,{y:()=>v});var l=n(23441),o=n(59805),r=n(72375),s=n(7971),a=n(69949),t=n(81530),u=n(46976),d=n.n(u),c=n(55093);const m=/^max([A-Za-z0-9]+)PerContainer$/,v=e=>{var i,n,u,v,p,h,y,f,b,x,_,A,k,j,S,P,N,F,I,w,V;let{currentImage:C,currentResourceGroup:K="",currentProjectName:M,ignorePerContainerConfig:E=!1}=e;const T=(0,l.CX)(),[R]=(0,s.bL)(),q=d().omit(R,["cpu","mem","shmem"]),{resourceGroups:$}=(0,t.Bk)(),{data:L,refetch:z,isRefetching:B}=(0,a.nj)({queryKey:["check-presets",M,K],queryFn:()=>K&&d().some($,(e=>e.name===K))?T.resourcePreset.check({group:M,scaling_group:K}).catch((()=>{})):null,staleTime:1e3}),D=(null===(i=d().find(null===C||void 0===C?void 0:C.resource_limits,(e=>"mem"===(null===e||void 0===e?void 0:e.key))))||void 0===i?void 0:i.min)||"0g",U={cpu:d().isEmpty(null===L||void 0===L||null===(n=L.scaling_groups[K])||void 0===n||null===(u=n.using)||void 0===u?void 0:u.cpu)||d().isEmpty(null===L||void 0===L||null===(v=L.scaling_groups[K])||void 0===v||null===(p=v.remaining)||void 0===p?void 0:p.cpu)?void 0:d().toNumber(null===L||void 0===L||null===(h=L.scaling_groups[K])||void 0===h?void 0:h.using.cpu)+d().toNumber(null===L||void 0===L||null===(y=L.scaling_groups[K])||void 0===y?void 0:y.remaining.cpu),mem:d().isEmpty(null===L||void 0===L||null===(f=L.scaling_groups[K])||void 0===f||null===(b=f.using)||void 0===b?void 0:b.mem)||d().isEmpty(null===L||void 0===L||null===(x=L.scaling_groups[K])||void 0===x||null===(_=x.remaining)||void 0===_?void 0:_.mem)?void 0:(null===(A=(0,r.Is)(d().toNumber(null===L||void 0===L||null===(k=L.scaling_groups[K])||void 0===k?void 0:k.using.mem)+d().toNumber(null===L||void 0===L||null===(j=L.scaling_groups[K])||void 0===j?void 0:j.remaining.mem)+"b","g",2))||void 0===A?void 0:A.numberFixed)+"g",accelerators:d().reduce(q,((e,i,n)=>{var l,o,r,s,a,t;return e[n]=d().isEmpty(null===L||void 0===L||null===(l=L.scaling_groups[K])||void 0===l||null===(o=l.using)||void 0===o?void 0:o[n])||d().isEmpty(null===L||void 0===L||null===(r=L.scaling_groups[K])||void 0===r||null===(s=r.remaining)||void 0===s?void 0:s[n])?void 0:d().toNumber(null===L||void 0===L||null===(a=L.scaling_groups[K])||void 0===a?void 0:a.using[n])+d().toNumber(null===L||void 0===L||null===(t=L.scaling_groups[K])||void 0===t?void 0:t.remaining[n]),e}),{})},Q=(0,c.useMemo)((()=>d().omitBy(T._config,((e,i)=>!m.test(i)))),[T._config]);return[{resourceGroupResourceSize:U,resourceLimits:{cpu:void 0===(null===R||void 0===R?void 0:R.cpu)?void 0:{min:d().max([d().toNumber((null===(S=d().find(null===C||void 0===C?void 0:C.resource_limits,(e=>"cpu"===(null===e||void 0===e?void 0:e.key))))||void 0===S?void 0:S.min)||"0")]),max:d().min([E?void 0:T._config.maxCPUCoresPerContainer,g(null===L||void 0===L?void 0:L.keypair_limits.cpu),g(null===L||void 0===L?void 0:L.group_limits.cpu)])},mem:void 0===(null===R||void 0===R?void 0:R.mem)?void 0:{min:(0,r.sL)(d().max([null===(P=(0,r.Is)(D,"b"))||void 0===P?void 0:P.number,null===(N=(0,r.Is)(o.t2,"b"))||void 0===N?void 0:N.number,0])+"b",o.t2),max:d().min([E?void 0:T._config.maxMemoryPerContainer,g(null===L||void 0===L?void 0:L.keypair_limits.mem)&&(null===(F=(0,r.Is)(g(null===L||void 0===L?void 0:L.keypair_limits.mem)+"","g"))||void 0===F?void 0:F.number),g(null===L||void 0===L?void 0:L.group_limits.mem)&&(null===(I=(0,r.Is)(g(null===L||void 0===L?void 0:L.group_limits.mem)+"","g"))||void 0===I?void 0:I.number)])+"g"},accelerators:d().reduce(q,((e,i,n)=>{var l,o,r;const s=null!==(l=d().find(Q,((e,i)=>((e,i)=>{const n=e.match(m);if(n){const e=n[1].toLowerCase(),l=i.replaceAll(/[.-]/g,"").toLowerCase();return e===l||e===l+"s"}return!1})(i,n))))&&void 0!==l?l:T._config["cuda.device"];return e[n]={min:parseInt((null===(o=d().filter(null===C||void 0===C?void 0:C.resource_limits,(e=>(null===e||void 0===e?void 0:e.key)===n)))||void 0===o||null===(r=o[0])||void 0===r?void 0:r.min)||"0"),max:d().min([s||8,g(null===L||void 0===L?void 0:L.keypair_limits[n]),g(null===L||void 0===L?void 0:L.group_limits[n])])},e}),{})},remaining:{accelerators:d().reduce(q,((e,i,n)=>{var l;return e[n]=null!==(l=d().min([d().toNumber(null===L||void 0===L?void 0:L.keypair_remaining[n]),d().toNumber(null===L||void 0===L?void 0:L.group_remaining[n]),d().toNumber(null===L||void 0===L?void 0:L.scaling_group_remaining[n])]))&&void 0!==l?l:Number.MAX_SAFE_INTEGER,e}),{}),cpu:null!==(w=d().min([g(null===L||void 0===L?void 0:L.keypair_remaining.cpu),g(null===L||void 0===L?void 0:L.group_remaining.cpu),g(null===L||void 0===L?void 0:L.scaling_group_remaining.cpu)]))&&void 0!==w?w:Number.MAX_SAFE_INTEGER,mem:null!==(V=d().min([g(null===L||void 0===L?void 0:L.keypair_remaining.mem),g(null===L||void 0===L?void 0:L.group_remaining.mem),g(null===L||void 0===L?void 0:L.scaling_group_remaining.mem)]))&&void 0!==V?V:Number.MAX_SAFE_INTEGER},currentImageMinM:D,isRefetching:B,checkPresetInfo:L},{refetch:z}]},g=e=>void 0===e||"Infinity"===e||"NaN"===e?void 0:d().toNumber(e)}}]);
//# sourceMappingURL=8922.fdf932b1.chunk.js.map