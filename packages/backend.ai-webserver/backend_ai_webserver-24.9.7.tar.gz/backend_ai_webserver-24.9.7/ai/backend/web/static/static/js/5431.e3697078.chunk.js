"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[5431,5863],{97759:(e,n,l)=>{l.d(n,{A:()=>t});var a=l(77946),i=(l(55093),l(66460)),r=l(79569);const o=(0,a.rU)((e=>{let{css:n,token:l}=e;return{hover:n`
    text-decoration: none;
    color: inherit;

    &:hover {
      color: ${l.colorLinkHover};
      text-decoration: underline;
    }
  `}})),t=e=>{let{type:n,...l}=e;const{styles:a}=o();return(0,r.jsx)(i.N_,{className:"hover"===n?a.hover:void 0,...l})}},4101:(e,n,l)=>{l.d(n,{Ay:()=>h,z7:()=>p});var a=l(72338),i=l(42926),r=l(43605),o=l(79597),t=l(1364),s=l(91043),d=l(46976),u=l.n(d),m=l(55093),c=l(33364),v=l(79569);const g=[/AUTH/i,/ACCESS/i,/SECRET/i,/_KEY/i,/PASSWORD/i,/PASSWD/i,/PWD/i,/TOKEN/i,/PRIVATE/i,/CREDENTIAL/i,/JWT/i,/KEYPAIR/i,/CERTIFICATE/i,/SSH/i,/ENCRYPT/i,/SIGNATURE/i,/SALT/i,/PIN/i,/PASSPHRASE/i,/OAUTH/i];function p(e){return u().map(e,(e=>{return e&&(n=e.variable,g.some((e=>e.test(n))))?{...e,value:""}:e;var n}))}const h=e=>{let{formItemProps:n,...l}=e;const d=(0,m.useRef)(null),{t:g}=(0,c.Bd)(),p=o.A.useFormInstance();return(0,v.jsx)(o.A.List,{...l,children:(e,m)=>{let{add:c,remove:h}=m;return(0,v.jsxs)(a.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((r,s)=>{let{key:m,name:c,...y}=r;return(0,v.jsxs)(a.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,v.jsx)(o.A.Item,{...y,style:{marginBottom:0,flex:1},name:[c,"variable"],rules:[{required:!0,message:g("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:g("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:n}=e;return{validator(e,a){const i=u().map(n(l.name),(e=>null===e||void 0===e?void 0:e.variable));return!u().isEmpty(a)&&i.length>0&&u().filter(i,(e=>e===a)).length>1?Promise.reject(g("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...n,children:(0,v.jsx)(t.A,{ref:s===e.length-1?d:null,placeholder:"Variable",onChange:()=>{const n=e.map(((e,n)=>[l.name,n,"variable"]));p.validateFields(n)}})}),(0,v.jsx)(o.A.Item,{...y,name:[c,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:g("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,v.jsx)(t.A,{placeholder:"Value"})}),(0,v.jsx)(i.A,{onClick:()=>h(c)})]},m)})),(0,v.jsx)(o.A.Item,{noStyle:!0,children:(0,v.jsx)(s.Ay,{type:"dashed",onClick:()=>{c(),setTimeout((()=>{d.current&&d.current.focus()}),0)},icon:(0,v.jsx)(r.A,{}),block:!0,children:g("session.launcher.AddEnvironmentVariable")})})]})}})}},75863:(e,n,l)=>{l.r(n),l.d(n,{default:()=>s,useFolderExplorerOpener:()=>d});var a=l(55093),i=l(42588),r=l(2647),o=l(79569);const t=a.lazy((()=>Promise.all([l.e(1817),l.e(6119)]).then(l.bind(l,76119)))),s=()=>{const[e,n]=(0,r.useQueryParam)("folder",r.StringParam),l=null===e||void 0===e?void 0:e.replaceAll("-","");return(0,o.jsx)(t,{vfolderID:l||"",open:!!l,onRequestClose:()=>{n(null,"replaceIn")},destroyOnClose:!0})},d=()=>{const[,e]=(0,r.useQueryParam)("folder",r.StringParam),n=(0,i.zy)();return{open:n=>{e(n)},generateFolderPath:e=>{const l=new URLSearchParams(n.search);return l.set("folder",e),{pathname:n.pathname,search:l.toString()}}}}},60828:(e,n,l)=>{l.d(n,{A:()=>F});var a=l(72375),i=l(23441),r=l(77702),o=l(91238),t=l(72338);var s,d=l(90184),u=l(32715),m=l(96141),c=l(79597),v=l(66596),g=l(12221),p=l(47543),h=l(25913),y=l(92047),f=l(1364),A=l(46976),x=l.n(A),j=l(55093),_=l(33364),k=l(63821),b=l(79569);const F=e=>{var n;let{filter:A,showPrivate:F}=e;const w=c.A.useFormInstance(),S=c.A.useWatch("environments",{form:w,preserve:!0}),V=(0,i.CX)(),I=null===V||void 0===V?void 0:V.supports("extended-image-info"),[C,K]=(0,j.useState)(""),[N,P]=(0,j.useState)(""),{t:E}=(0,_.Bd)(),[T,{getBaseVersion:M,getImageMeta:R,tagAlias:L}]=(0,i.Gj)(),{token:O}=v.A.useToken(),{isDarkMode:B}=(0,r.e)(),z=(0,j.useRef)(null),$=(0,j.useRef)(null),q=null!==V&&void 0!==V&&null!==(n=V._config)&&void 0!==n&&n.showNonInstalledImages?{}:{installed:!0},{images:G}=(0,k.useLazyLoadQuery)(void 0!==s?s:s=l(3796),q,{fetchPolicy:"store-and-network"});(0,j.useEffect)((()=>{var e,n,l;if(!x().isEmpty(null===S||void 0===S?void 0:S.manual))return void((S.environment||S.version)&&w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}}));let i,r,o,t,s=null===(e=w.getFieldValue("environments"))||void 0===e?void 0:e.version;var d,u;(s&&s.indexOf("@")<0&&(s+="@x86_64"),s&&x().find(D,(e=>(i=x().find(e.environmentGroups,(e=>(r=x().find(e.images,(e=>(0,a.A_)(e)===s)),!!r))),!!i))),i?(o=i,t=r):w.getFieldValue(["environments","environment"])&&x().find(D,(e=>{var n;return o=x().find(e.environmentGroups,(e=>e.environmentName===w.getFieldValue(["environments","environment"]))),t=null===(n=o)||void 0===n?void 0:n.images[0],!!o})),o&&t)||(o=null===(d=D[0])||void 0===d?void 0:d.environmentGroups[0],t=null===(u=o)||void 0===u?void 0:u.images[0]);const m=null===(n=x().find(null===(l=t)||void 0===l?void 0:l.labels,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.value;t?!i&&V._config.allow_manual_image_name_for_session&&s?w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:s,customizedTag:null!==m&&void 0!==m?m:void 0}}):w.setFieldsValue({environments:{environment:o.environmentName,version:(0,a.A_)(t),image:t,customizedTag:null!==m&&void 0!==m?m:void 0}}):V._config.allow_manual_image_name_for_session&&w.setFieldValue(["environments","manual"],s)}),[null===S||void 0===S?void 0:S.version,null===S||void 0===S?void 0:S.manual]);const D=(0,j.useMemo)((()=>x().chain(G).filter((e=>(!!F||!(e=>x().some(null===e||void 0===e?void 0:e.labels,(e=>{var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))})))(e))&&(!A||A(e)))).groupBy((e=>{var n;return(null===T||void 0===T||null===(n=T.imageInfo[R((0,a.A_)(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map(((e,n)=>({groupName:n,environmentGroups:x().chain(e).groupBy((e=>`${null===e||void 0===e?void 0:e.registry}/${I?null===e||void 0===e?void 0:e.namespace:null===e||void 0===e?void 0:e.name}`)).map(((e,n)=>{var l,i;const r=null===(l=n.split("/"))||void 0===l?void 0:l[2];return{environmentName:n,displayName:r&&(null===T||void 0===T||null===(i=T.imageInfo[r])||void 0===i?void 0:i.name)||x().last(n.split("/")),prefix:x().chain(n).split("/").drop(1).dropRight(1).join("/").value(),images:e.sort(((e,n)=>{var l,i,r,o,t,s;return function(e,n){const l=e.split(".").map(Number),a=n.split(".").map(Number);for(let i=0;i<Math.max(l.length,a.length);i++){const e=l[i]||0,n=a[i]||0;if(e>n)return 1;if(e<n)return-1}return 0}(null!==(l=null===n||void 0===n||null===(i=n.tag)||void 0===i||null===(r=i.split("-"))||void 0===r?void 0:r[0])&&void 0!==l?l:"",null!==(o=null===e||void 0===e||null===(t=e.tag)||void 0===t||null===(s=t.split("-"))||void 0===s?void 0:s[0])&&void 0!==o?o:"")||(0,a._f)(null===e||void 0===e?void 0:e.architecture,null===n||void 0===n?void 0:n.architecture)}))}})).sortBy((e=>e.displayName)).value()}))).sortBy((e=>e.groupName)).value()),[G,T,A,F]),{fullNameMatchedImage:Q}=(0,j.useMemo)((()=>{let e,n;return C.length&&x().chain(D.flatMap((e=>e.environmentGroups)).find((l=>(n=l,e=x().find(l.images,(e=>(0,a.A_)(e)===C)),!!e)))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[C,D]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,b.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:(0,b.jsxs)(g.A.Text,{copyable:{text:(0,a.A_)(w.getFieldValue(["environments","image"]))},children:[E("session.launcher.Environments")," /"," ",E("session.launcher.Version")]}),rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],style:{marginBottom:10},children:(0,b.jsx)(p.A,{ref:z,showSearch:!0,searchValue:C,onSearch:K,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:e=>{if(Q)w.setFieldsValue({environments:{environment:(I?null===Q||void 0===Q?void 0:Q.namespace:null===Q||void 0===Q?void 0:Q.name)||"",version:(0,a.A_)(Q),image:Q}});else{const n=D.flatMap((e=>e.environmentGroups)).filter((n=>n.environmentName===e))[0].images[0];w.setFieldsValue({environments:{environment:(I?null===n||void 0===n?void 0:n.namespace:null===n||void 0===n?void 0:n.name)||"",version:(0,a.A_)(n),image:n}})}},disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:Q?(0,b.jsx)(p.A.Option,{value:I?null===Q||void 0===Q?void 0:Q.namespace:null===Q||void 0===Q?void 0:Q.name,filterValue:(0,a.A_)(Q),children:(0,b.jsxs)(t.A,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,b.jsx)(d.A,{image:(0,a.A_)(Q)||"",style:{width:15,height:15}}),(0,a.A_)(Q)]})}):x().map(D,(e=>(0,b.jsx)(p.A.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(e=>{var n;const l=e.images[0],i=null===T||void 0===T?void 0:T.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[2]],r=[];let o=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(r.push(e.prefix),o=(0,b.jsx)(h.A,{color:"purple",children:(0,b.jsx)(m.A,{keyword:C,children:e.prefix})}));const s=x().map(null===i||void 0===i?void 0:i.label,(e=>x().isUndefined(e.category)&&e.tag&&e.color?(r.push(e.tag),(0,b.jsx)(h.A,{color:e.color,children:(0,b.jsx)(m.A,{keyword:C,children:e.tag},e.tag)},e.tag)):null));return(0,b.jsx)(p.A.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+r.join("\t"),children:(0,b.jsxs)(t.A,{direction:"row",justify:"between",children:[(0,b.jsxs)(t.A,{direction:"row",align:"center",gap:"xs",children:[(0,b.jsx)(d.A,{image:(0,a.A_)(l)||"",style:{width:15,height:15}}),(0,b.jsx)(m.A,{keyword:C,children:e.displayName})]}),(0,b.jsxs)(t.A,{direction:"row",className:B?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:O.marginXS,flexShrink:1},children:[o,s]})]})},e.environmentName)}))},e.groupName)))})}),(0,b.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,a;return(null===(l=e.environments)||void 0===l?void 0:l.environment)!==(null===(a=n.environments)||void 0===a?void 0:a.environment)},children:e=>{var n;let l,{getFieldValue:i}=e;return x().find(D,(e=>x().find(e.environmentGroups,(e=>{var n;return e.environmentName===(null===(n=i("environments"))||void 0===n?void 0:n.environment)&&(l=e,!0)})))),(0,b.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],children:(0,b.jsx)(p.A,{ref:$,onChange:e=>{const n=x().find(G,(n=>(0,a.A_)(n)===e));w.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:N,onSearch:P,optionFilterProp:"filterValue",dropdownRender:e=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(t.A,{style:{fontWeight:O.fontWeightStrong,paddingLeft:O.paddingSM},children:[E("session.launcher.Version"),(0,b.jsx)(y.A,{type:"vertical"}),E("session.launcher.Architecture"),(0,b.jsx)(y.A,{type:"vertical"}),E("session.launcher.Tags")]}),(0,b.jsx)(y.A,{style:{margin:"8px 0"}}),e]}),disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:x().map(x().uniqBy(null===(n=l)||void 0===n?void 0:n.images,"id"),(e=>{var n;const[l,i,...r]=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""];let s=null===T||void 0===T?void 0:T.tagAlias[i];if(!s){for(const[e,n]of Object.entries((null===T||void 0===T?void 0:T.tagReplace)||{})){const l=new RegExp(e);l.test(i)&&(s=null===i||void 0===i?void 0:i.replace(l,n))}s||(s=i)}const d=[],c=x().chain(r).filter((e=>!e.startsWith("customized_"))).map(((e,n)=>(0,b.jsx)(o.A,{values:x().split((null===T||void 0===T?void 0:T.tagAlias[e])||e,":").map((e=>(d.push(e),{label:e,highlightKeyword:N})))},n))).value(),v=null===e||void 0===e?void 0:e.labels;if(v){const e=x().findIndex(v,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key)));if(e&&v[e]){var g;const n=(null===(g=v[e])||void 0===g?void 0:g.value)||"";d.push("Customized"),d.push(n),c.push((0,b.jsx)(o.A,{highlightKeyword:N,values:[{label:"Customized",color:"cyan"},{label:null!==n&&void 0!==n?n:"",color:"cyan"}]},c.length+1))}}return(0,b.jsx)(p.A.Option,{value:(0,a.A_)(e),filterValue:[l,s,null===e||void 0===e?void 0:e.architecture,...d].join("\t"),children:I?(0,b.jsxs)(t.A,{direction:"row",children:[(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.version}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(t.A,{direction:"row",align:"start",children:x().map(null===e||void 0===e?void 0:e.tags,(n=>{var l;const i=x().includes(n.key,"customized_"),r=i?null===(l=x().find(null===e||void 0===e?void 0:e.labels,{key:"ai.backend.customized-image.name"}))||void 0===l?void 0:l.value:n.value,t=L(n.key+r);return x().isEqual(t,(0,a.WY)(n.key+r))?(0,b.jsx)(o.A,{highlightKeyword:N,values:[{label:L(n.key),color:i?"cyan":"blue"},{label:null!==r&&void 0!==r?r:"",color:i?"cyan":"blue"}]},n.key):(0,b.jsx)(h.A,{color:i?"cyan":"blue",children:(0,b.jsx)(m.A,{keyword:N,children:t})},n.key)}))})]}):(0,b.jsx)(t.A,{direction:"row",justify:"between",children:(0,b.jsxs)(t.A,{direction:"row",children:[(0,b.jsx)(m.A,{keyword:N,children:M((0,a.A_)(e)||"")}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(u.Jj,{tag:(null===e||void 0===e?void 0:e.tag)||"",highlightKeyword:N,labels:null===e||void 0===e?void 0:e.labels})]})})},null===e||void 0===e?void 0:e.id)}))})})}}),(0,b.jsx)(c.A.Item,{label:E("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:V._config.allow_manual_image_name_for_session?"block":"none"},children:(0,b.jsx)(f.A,{allowClear:!0,onChange:e=>{x().isEmpty(e)||w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,b.jsx)(c.A.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,b.jsx)(f.A,{})})]})}},32715:(e,n,l)=>{l.d(n,{Ay:()=>y,Jj:()=>f});var a=l(72375),i=l(23441),r=l(91238),o=l(72338),t=l(96141),s=l(25913),d=l(46976),u=l.n(d),m=l(55093),c=l(79569);const v=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageAliasName:a,getBaseVersion:o,tagAlias:t}]=(0,i.Gj)();return(0,c.jsx)(r.A,{values:[{label:t(a(n)),color:"blue"},{label:o(n),color:"green"}],...l})},g=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseImage:a,tagAlias:r}]=(0,i.Gj)();return u().isEmpty(r(a(n)))?null:(0,c.jsx)(s.A,{color:"green",...l,children:r(a(n))})},p=e=>{let{image:n,...l}=e;n=n||"";const[,{getArchitecture:a,tagAlias:r}]=(0,i.Gj)();return u().isEmpty(r(a(n)))?null:(0,c.jsx)(s.A,{color:"green",...l,children:a(n)})},h=(e,n)=>{let{image:l,style:a={}}=e;return l=l||"",(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(v,{image:l}),(0,c.jsx)(g,{image:l}),(0,c.jsx)(p,{image:l})]})},y=m.memo(h),f=e=>{let{tag:n,labels:l,highlightKeyword:d,...m}=e;l=l||[];const[,{getTags:v,tagAlias:g}]=(0,i.Gj)(),p=v(n,l);return(0,c.jsx)(o.A,{direction:"row",align:"start",children:u().map(p,((e,n)=>{const l="Customized"===e.key,i=g(e.key+e.value);return u().isEqual(i,(0,a.WY)(e.key+e.value))?(0,c.jsx)(r.A,{highlightKeyword:d,values:[{label:g(e.key),color:l?"cyan":"blue"},{label:e.value,color:l?"cyan":"blue"}]},e.key):(0,c.jsx)(s.A,{color:l?"cyan":"blue",children:(0,c.jsx)(t.A,{keyword:d,children:i},n)},e.key)}))})}},31270:(e,n,l)=>{l.d(n,{A:()=>d});var a,i=l(91238),r=l(46976),o=l.n(r),t=(l(55093),l(63821)),s=l(79569);const d=e=>{let{vFolderFrgmt:n=null,permission:r}=e;const d=(0,t.useFragment)(void 0!==a?a:a=l(13182),n),u=o().chain({r:"green",w:"blue",d:"red"}).map(((e,n)=>{if(((e,n)=>!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n))((null===d||void 0===d?void 0:d.permission)||r,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,s.jsx)(i.A,{values:u})}},78261:(e,n,l)=>{l.a(e,(async(e,a)=>{try{l.d(n,{Ay:()=>$,BQ:()=>B,tf:()=>z});var i,r=l(72375),o=l(23441),t=l(6742),s=l(69949),d=l(85730),u=l(81530),m=l(68098),c=l(97759),v=l(59764),g=l(72338),p=l(10144),h=l(75863),y=l(96141),f=l(31270),A=l(42927),x=l(4710),j=l(99159),_=l(79597),k=l(12221),b=l(2556),F=l(1364),w=l(91043),S=l(8656),V=l(76082),I=l(25913),C=l(78502),K=l.n(C),N=l(46976),P=l.n(N),E=l(43747),T=l(55093),M=l(33364),R=l(63821),L=l(79569),O=e([v,p]);[v,p]=O.then?(await O)():O;const B=/^[a-zA-Z0-9_/.-]*$/,z="/home/work/",$=e=>{let{filter:n,showAliasInput:a=!1,selectedRowKeys:C=[],onChangeSelectedRowKeys:N,aliasBasePath:O=z,aliasMap:$,onChangeAliasMap:q,rowKey:G="name",onChangeAutoMountedFolders:D,showAutoMountedFoldersSection:Q,...W}=e;const{generateFolderPath:U}=(0,h.useFolderExplorerOpener)(),J=T.useMemo((()=>e=>e&&e[G]),[G]),[H,Y]=(0,T.useState)(!1),[X,Z]=(0,d.A)({value:C,onChange:N},{defaultValue:[]}),[ee,ne]=(0,d.A)({value:$,onChange:q},{defaultValue:{}}),le=(0,o.CX)(),[ae]=(0,t.x)(null===le||void 0===le?void 0:le._config.accessKey),[ie]=_.A.useForm();(0,T.useEffect)((()=>{ee&&(ie.setFieldsValue(P().mapValues(ee,(e=>e.startsWith(O)?e.slice(O.length):e))),ie.validateFields())}),[ee,ie,O]);const{t:re}=(0,M.Bd)(),oe=(0,r.QE)(),te=(0,u.hd)(),[se,de]=(0,o.Tw)("first"),[ue,me]=(0,T.useTransition)(),{data:ce}=(0,s.nj)({queryKey:["VFolderSelectQuery",se,te.id],queryFn:()=>{const e=new URLSearchParams;return e.set("group_id",te.id),oe({method:"GET",url:`/folders?${e.toString()}`})},staleTime:1e3}),{domain:ve,group:ge,keypair_resource_policy:pe}=(0,R.useLazyLoadQuery)(void 0!==i?i:i=l(37449),{domain_name:le._config.domainName,group_id:te.id,keypair_resource_policy_name:(null===ae||void 0===ae?void 0:ae.resource_policy)||""},{fetchPolicy:"store-and-network",fetchKey:se}),he=(0,T.useMemo)((()=>{const e=JSON.parse((null===ve||void 0===ve?void 0:ve.allowed_vfolder_hosts)||"{}"),n=JSON.parse((null===ge||void 0===ge?void 0:ge.allowed_vfolder_hosts)||"{}"),l=JSON.parse((null===pe||void 0===pe?void 0:pe.allowed_vfolder_hosts)||"{}"),a=P().merge({},e,n,l),i=Object.keys(a).filter((e=>a[e].includes("mount-in-session")));return null===ce||void 0===ce?void 0:ce.filter((e=>i.includes(e.host)))}),[ve,ge,pe,ce]),ye=(0,T.useMemo)((()=>P().chain(he).filter((e=>{var n;return"ready"===e.status&&(null===(n=e.name)||void 0===n?void 0:n.startsWith("."))})).map((e=>e.name)).value()),[he]);(0,T.useEffect)((()=>{P().isFunction(D)&&D(ye)}),[ye]);const[fe,Ae]=(0,T.useState)(""),xe=P().chain(he).filter((e=>!n||n(e))).filter((e=>!!X.includes(J(e))||(!fe||e.name.includes(fe)))).value(),je=(0,T.useCallback)(((e,n)=>void 0===n||""===n?`${O}${e}`:n.startsWith("/")?n:`${O}${n}`),[O]),_e=(0,m.E)((()=>{ne(P().mapValues(P().pickBy(ie.getFieldsValue({strict:!1}),(e=>!!e)),((e,n)=>je(n,e)))),ie.validateFields().catch((()=>{}))}));(0,T.useEffect)((()=>{_e()}),[JSON.stringify(X),_e]);const ke=(0,v.useShadowRoot)(),be=[{title:(0,L.jsxs)(g.A,{direction:"row",gap:"xxs",children:[(0,L.jsx)(k.A.Text,{children:re("data.folders.Name")}),a&&(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)(k.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",re("session.launcher.FolderAlias")," ",(0,L.jsx)(b.A,{title:(0,L.jsx)(M.x6,{i18nKey:"session.launcher.DescFolderAlias"}),getPopupContainer:()=>ke,children:(0,L.jsx)(A.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>{const l=X.includes(J(n));return(0,L.jsxs)(g.A,{direction:"column",align:"start",gap:"xxs",style:a&&l?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,L.jsx)(c.A,{type:"hover",to:U(n.id),children:(0,L.jsx)(y.A,{keyword:fe,children:e})}),a&&l&&(0,L.jsx)(_.A.Item,{noStyle:!0,shouldUpdate:(e,l)=>e[J(n)]!==l[J(n)],children:()=>{const e=P()(X).reduce(((e,n)=>(e[n]=(null===ee||void 0===ee?void 0:ee[n])||je(n,void 0),e)),{});return(0,L.jsx)(_.A.Item,{name:J(n),rules:[{type:"string",pattern:B,message:re("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(l,a)=>a&&P().some(e,((e,l)=>l!==J(n)&&e===je(J(n),a)))?Promise.reject(re("session.launcher.FolderAliasOverlapping")):Promise.resolve()},{type:"string",validator:async(e,l)=>{const a=je(J(n),l);return l&&P().map(ye,(e=>je("",e))).includes(a)?Promise.reject(re("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],extra:je(n.name,ie.getFieldValue(J(n))),children:(0,L.jsx)(F.A,{onClick:e=>{e.stopPropagation()},placeholder:re("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{_e()}})})}})]})}},{title:re("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,n)=>e.usage_mode.localeCompare(n.usage_mode)},{title:re("data.Host"),dataIndex:"host"},{title:re("data.Type"),dataIndex:"type",sorter:(e,n)=>e.type.localeCompare(n.type),render:(e,n)=>(0,L.jsxs)(g.A,{direction:"column",children:["user"===n.type?(0,L.jsx)(x.A,{title:"User"}):(0,L.jsx)("div",{children:"Group"}),"group"===n.type&&`(${n.group_name})`]})},{title:re("data.Permission"),dataIndex:"permission",sorter:(e,n)=>e.permission.localeCompare(n.permission),render:(e,n)=>(0,L.jsx)(f.A,{permission:n.permission})},{title:re("data.Created"),dataIndex:"created_at",sorter:(e,n)=>e.created_at.localeCompare(n.created_at),render:(e,n)=>K()(e).format("L"),defaultSortOrder:"descend"}];return(0,L.jsxs)(g.A,{direction:"column",align:"stretch",gap:"xs",children:[(0,L.jsxs)(g.A,{direction:"row",gap:"xs",justify:"between",children:[(0,L.jsx)(F.A,{value:fe,onChange:e=>Ae(e.target.value),allowClear:!0,placeholder:re("data.SearchByName")}),(0,L.jsx)(b.A,{title:re("button.Refresh"),children:(0,L.jsx)(w.Ay,{loading:ue,icon:(0,L.jsx)(j.A,{}),onClick:()=>{me((()=>{de()}))}})}),(0,L.jsx)(b.A,{title:re("data.CreateANewStorageFolder"),children:(0,L.jsx)(w.Ay,{icon:(0,L.jsx)(E.A,{}),type:"primary",ghost:!0,onClick:()=>{Y(!0)}})})]}),(0,L.jsx)(_.A,{form:ie,component:!1,preserve:!1,children:(0,L.jsx)(S.A,{scroll:{x:"max-content"},rowKey:J,rowSelection:{selectedRowKeys:X,onChange:e=>{Z(e),_e()}},showSorterTooltip:!1,columns:be,dataSource:xe,onRow:(e,n)=>({onClick:n=>{var l;const a=n.target;null!==a&&void 0!==a&&null!==(l=a.classList)&&void 0!==l&&l.contains("ant-table-selection-column")&&(n.stopPropagation(),X.includes(J(e))?Z(X.filter((n=>n!==J(e)))):Z([...X,J(e)]))}}),sortDirections:["ascend","descend"],...W})}),Q&&ye.length>0?(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(V.A,{size:"small",children:(0,L.jsx)(V.A.Item,{label:re("data.AutomountFolders"),children:P().map(ye,(e=>(0,L.jsx)(I.A,{children:e},e)))})})}):null,(0,L.jsx)(p.A,{open:H,onRequestClose:e=>{Y(!1),e&&me((()=>{de(),Z((n=>[...n,e[G]]))}))}})]})};a()}catch(B){a(B)}}))},83770:(e,n,l)=>{l.a(e,(async(e,a)=>{try{l.d(n,{A:()=>c});var i=l(78261),r=l(79597),o=l(1364),t=l(46976),s=l.n(t),d=(l(55093),l(33364)),u=l(79569),m=e([i]);i=(m.then?(await m)():m)[0];const c=e=>{let{filter:n,rowKey:l="name",tableProps:a,...t}=e;const m=r.A.useFormInstance(),{t:c}=(0,d.Bd)();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(r.A.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator(e,n){const l=s().chain(m.getFieldValue("mounts")).reduce(((e,l)=>(e[l]=n[l]||"/home/work/"+l,e)),{}).values().value();return s().uniq(l).length!==l.length?Promise.reject(c("session.launcher.FolderAliasOverlapping")):s().some(l,(e=>!i.BQ.test(e)))?Promise.reject(c("session.launcher.FolderAliasInvalid")):s().some(m.getFieldValue("autoMountedFolderNames"),(e=>l.includes(i.tf+e)))?Promise.reject(c("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],children:(0,u.jsx)(o.A,{})}),(0,u.jsx)(r.A.Item,{hidden:!0,name:"autoMountedFolderNames"}),(0,u.jsx)(r.A.Item,{name:"mounts",...t,valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,u.jsx)(i.Ay,{rowKey:l,showAliasInput:!0,aliasMap:m.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:e=>{m.setFieldValue("vfoldersAliasMap",e),m.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:n,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:e=>{m.setFieldValue("autoMountedFolderNames",e)},...a})})]})};a()}catch(c){a(c)}}))},3796:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},l=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base_image_name",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:a,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:a},params:{cacheID:"9ff1339a66b7da77df70de956e3c7dd8",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:'query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    name @deprecatedSince(version: "24.12.0")\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    namespace @since(version: "24.12.0")\n    base_image_name @since(version: "24.12.0")\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    version @since(version: "24.12.0")\n  }\n}\n'}}}();a.hash="40b2d995106300fffb0c3a5d66103d38";const i=a},13182:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},i=a},37449:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"group_id"},{defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domain_name"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"id",variableName:"group_id"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderTableProjectQuery",selections:l,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderTableProjectQuery",selections:l},params:{cacheID:"2c2ce905afd89e93c6d761f22ed59f3d",id:null,metadata:{},name:"VFolderTableProjectQuery",operationKind:"query",text:"query VFolderTableProjectQuery(\n  $domain_name: String!\n  $group_id: UUID!\n  $keypair_resource_policy_name: String!\n) {\n  domain(name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  group(id: $group_id, domain_name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();a.hash="ccdbaa52a63c2ea005423e7c541eff80";const i=a}}]);
//# sourceMappingURL=5431.e3697078.chunk.js.map