"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[9717],{9717:function(e,s,i){var t=i(22858).A,a=i(33994).A;i.a(e,function(){var e=t(a().mark((function e(t,n){var r,o,l,c,d,h,u,p,_,m,g,f,k,v,y,w,b,A,x,z,C,O,q,I,P,E,T,U,B,L,D,M,N,j,V,F,H,S,G,K,R,Z,J,W,Q,X,Y,$,ee,se,ie,te,ae,ne,re,oe,le,ce;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i.r(s),i.d(s,{DialogPersonBuildingManager:function(){return ce}}),r=i(64599),o=i(33994),l=i(22858),c=i(35806),d=i(71008),h=i(62193),u=i(2816),p=i(27927),_=i(88871),m=i(81027),g=i(44124),f=i(82386),k=i(39805),v=i(97741),y=i(50693),w=i(72735),b=i(29193),A=i(26098),x=i(10507),z=i(39790),C=i(66457),O=i(36604),q=i(79641),I=i(253),P=i(94438),E=i(16891),T=i(4525),U=i(15112),B=i(29818),L=i(94100),D=i(56864),i(77372),M=i(3276),i(24284),i(28066),N=i(52992),i(24640),i(90431),i(32084),j=i(94526),V=i(71443),F=i(6121),H=i(55321),S=i(84976),G=i(50070),K=i(18858),!(R=t([D,N])).then){e.next=76;break}return e.next=72,R;case 72:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=77;break;case 76:e.t0=R;case 77:Z=e.t0,D=Z[0],N=Z[1],re="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z",oe=["device_tracker"],le={round:!0,quality:.75,aspectRatio:1},ce=(0,p.A)([(0,B.EM)("dialog-person-building-manager")],(function(e,s){var i,t,a,n,p,_,m,g=function(s){function i(){var s;(0,d.A)(this,i);for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];return s=(0,h.A)(this,i,[].concat(a)),e(s),s}return(0,u.A)(i,s),(0,c.A)(i)}(s);return{F:g,d:[{kind:"field",decorators:[(0,B.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_name",value:function(){return""}},{kind:"field",decorators:[(0,B.wk)()],key:"_userId",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_user",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_isAdmin",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_localOnly",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_deviceTrackers",value:function(){return[]}},{kind:"field",decorators:[(0,B.wk)()],key:"_picture",value:function(){return null}},{kind:"field",decorators:[(0,B.wk)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_params",value:void 0},{kind:"field",decorators:[(0,B.wk)()],key:"_submitting",value:function(){return!1}},{kind:"field",decorators:[(0,B.wk)()],key:"_personExists",value:function(){return!1}},{kind:"field",decorators:[(0,B.wk)()],key:"_displayName",value:function(){return""}},{kind:"field",decorators:[(0,B.wk)()],key:"_username",value:function(){return""}},{kind:"field",decorators:[(0,B.wk)()],key:"_password",value:function(){return""}},{kind:"field",decorators:[(0,B.wk)()],key:"_confirmPassword",value:function(){return""}},{kind:"field",decorators:[(0,B.wk)()],key:"_localAccessOnly",value:function(){return!1}},{kind:"field",decorators:[(0,B.wk)()],key:"_administrator",value:function(){return!1}},{kind:"field",decorators:[(0,B.wk)()],key:"_buildingsList",value:function(){return[]}},{kind:"field",decorators:[(0,B.wk)()],key:"_selectedBuildingId",value:function(){return null}},{kind:"field",key:"_deviceTrackersAvailable",value:function(){return(0,L.A)((function(e){return Object.keys(e.states).some((function(e){return"device_tracker"===e.substr(0,e.indexOf("."))}))}))}},{kind:"method",key:"showDialog",value:(m=(0,l.A)((0,o.A)().mark((function e(s){var i,t,a=this;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._params=s,this._error=void 0,this._params.entry?(this._personExists=!0,this._name=this._params.entry.name||"",this._userId=this._params.entry.user_id||void 0,this._deviceTrackers=this._params.entry.device_trackers||[],this._picture=this._params.entry.picture||null,this._user=this._userId?this._params.users.find((function(e){return e.id===a._userId})):void 0,this._isAdmin=null===(i=this._user)||void 0===i?void 0:i.group_ids.includes(V.wj),this._localOnly=null===(t=this._user)||void 0===t?void 0:t.local_only):(this._personExists=!1,this._name="",this._userId=void 0,this._user=void 0,this._isAdmin=void 0,this._localOnly=void 0,this._deviceTrackers=[],this._picture=null),this._displayName="",this._username="",this._password="",this._confirmPassword="",this._localAccessOnly=!1,this._administrator=!1,e.next=11,this._fetchBuildings();case 11:return e.next=13,this.updateComplete;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{kind:"method",key:"render",value:function(){var e=this;if(!this._params)return U.s6;var s=""===this._name.trim();return(0,U.qy)(J||(J=(0,r.A)([' <ha-dialog open @closed="','" scrimClickAction escapeKeyAction .heading="','"> <div> ',' <div class="building-selection"> <label for="building-select">Select Building</label> <select id="building-select" name="selectedBuilding" @change="','"> ',' </select> </div> <div class="form"> <ha-textfield class="name" name="name" .value="','" @input="','" label="','" required .validationMessage="','" dialogInitialFocus></ha-textfield> <ha-picture-upload .hass="','" .value="','" crop .cropOptions="','" @change="','"></ha-picture-upload> <ha-textfield class="display-name" name="displayName" .value="','" @input="','" label="Display Name" required .validationMessage="','"></ha-textfield> <ha-textfield class="username" name="username" .value="','" @input="','" label="Username" required .validationMessage="','"></ha-textfield> <ha-password-field class="password" name="password" .value="','" @input="','" label="Password" required .validationMessage="','"></ha-password-field> <ha-password-field class="confirm-password" name="confirmPassword" .value="','" @input="','" label="Confirm Password" required .invalid="','" .errorMessage="','"></ha-password-field> <ha-settings-row> <span slot="heading"> ',' </span> <span slot="description"> ',' </span> <ha-switch .checked="','" @change="','"></ha-switch> </ha-settings-row> <ha-settings-row> <span slot="heading"> ',' </span> <span slot="description"> ',' </span> <ha-switch .checked="','" @change="','"></ha-switch> </ha-settings-row> '," "," </div> </div> ",' <ha-button slot="primaryAction" @click="','" .disabled="','"> '," </ha-button> </ha-dialog> "])),this._close,(0,M.l)(this.hass,this._params.entry?this._params.entry.name:this.hass.localize("ui.panel.config.person.detail.new_building_manager")),this._error?(0,U.qy)(W||(W=(0,r.A)(['<div class="error">',"</div>"])),this._error):"",this._handleBuildingChange,this._buildingsList.map((function(s){return(0,U.qy)(Q||(Q=(0,r.A)([' <option value="','" ?selected="','"> '," </option> "])),s.id,e._selectedBuildingId===s.id,s.name)})),this._name,this._handleValueChanged,this.hass.localize("ui.panel.config.person.detail.name"),this.hass.localize("ui.common.error_required"),this.hass,this._picture,le,this._pictureChanged,this._displayName,this._handleValueChanged,this.hass.localize("ui.common.error_required"),this._username,this._handleValueChanged,this.hass.localize("ui.common.error_required"),this._password,this._handleValueChanged,this.hass.localize("ui.common.error_required"),this._confirmPassword,this._handleValueChanged,""!==this._password&&""!==this._confirmPassword&&this._confirmPassword!==this._password,this.hass.localize("ui.panel.config.users.add_user.password_not_match"),this.hass.localize("ui.panel.config.person.detail.local_access_only"),this.hass.localize("ui.panel.config.person.detail.local_access_only_description"),this._localAccessOnly,this._localAccessOnlyChanged,this.hass.localize("ui.panel.config.person.detail.admin"),this.hass.localize("ui.panel.config.person.detail.admin_description"),this._administrator,this._administratorChanged,this._renderUserFields(),this._deviceTrackersAvailable(this.hass)?(0,U.qy)(X||(X=(0,r.A)([" <p> ",' </p> <ha-entities-picker .hass="','" .value="','" .includeDomains="','" .pickedEntityLabel="','" .pickEntityLabel="','" @value-changed="','"></ha-entities-picker> '])),this.hass.localize("ui.panel.config.person.detail.device_tracker_intro"),this.hass,this._deviceTrackers,oe,this.hass.localize("ui.panel.config.person.detail.device_tracker_picked"),this.hass.localize("ui.panel.config.person.detail.device_tracker_pick"),this._deviceTrackersChanged):(0,U.qy)(Y||(Y=(0,r.A)([" <p> ",' </p> <ul> <li> <a href="','" target="_blank" rel="noreferrer">','</a> </li> <li> <a @click="','" href="/config/integrations"> '," </a> </li> </ul> "])),this.hass.localize("ui.panel.config.person.detail.no_device_tracker_available_intro"),(0,S.o)(this.hass,"/integrations/#presence-detection"),this.hass.localize("ui.panel.config.person.detail.link_presence_detection_integrations"),this._close,this.hass.localize("ui.panel.config.person.detail.link_integrations_page")),this._params.entry?(0,U.qy)($||($=(0,r.A)([' <ha-button slot="secondaryAction" class="warning" @click="','" .disabled="','"> '," </ha-button> "])),this._deleteEntry,this._user&&this._user.is_owner||this._submitting,this.hass.localize("ui.panel.config.person.detail.delete")):U.s6,this._createOrUpdateEntry,s||this._submitting,this._params.entry?this.hass.localize("ui.panel.config.person.detail.update"):this.hass.localize("ui.panel.config.person.detail.create"))}},{kind:"method",key:"_handleValueChanged",value:function(e){this._error=void 0;var s=e.target;switch(s.name){case"name":this._name=s.value;break;case"displayName":this._displayName=s.value;break;case"username":this._username=s.value;break;case"password":this._password=s.value;break;case"confirmPassword":this._confirmPassword=s.value}}},{kind:"method",key:"_handleBuildingChange",value:function(e){var s=e.target;this._selectedBuildingId=Number(s.value)}},{kind:"method",key:"_localAccessOnlyChanged",value:function(e){var s=e.target;this._localAccessOnly=s.checked}},{kind:"method",key:"_administratorChanged",value:function(e){var s=e.target;this._administrator=s.checked}},{kind:"method",key:"_deviceTrackersChanged",value:function(e){this._error=void 0,this._deviceTrackers=e.detail.value}},{kind:"method",key:"_pictureChanged",value:function(e){this._error=void 0,this._picture=e.target.value}},{kind:"method",key:"_fetchBuildings",value:(_=(0,l.A)((0,o.A)().mark((function e(){var s,i;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(K.u,"/building/list"));case 3:return s=e.sent,e.next=6,s.json();case 6:(i=e.sent).success?(this._buildingsList=i.data,this._buildingsList.length>0&&!this._selectedBuildingId&&(this._selectedBuildingId=this._buildingsList[0].id)):this._error="Failed to load buildings",e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this._error=e.t0.message||"Unknown error while loading buildings";case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return _.apply(this,arguments)})},{kind:"method",key:"_createOrUpdateEntry",value:(p=(0,l.A)((0,o.A)().mark((function e(){var s,i,t,a,n,r;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._password===this._confirmPassword){e.next=3;break}return this._error=this.hass.localize("ui.panel.config.users.add_user.password_not_match"),e.abrupt("return");case 3:return s={display_name:this._displayName,username:this._username,password:this._password,confirm_password:this._confirmPassword,building_id:this._selectedBuildingId,local_access_only:this._localAccessOnly,administrator:this._administrator},e.prev=4,e.next=7,fetch("".concat(K.u,"/building/create-user/").concat(this._selectedBuildingId),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 7:if((i=e.sent).ok){e.next=16;break}return e.next=11,i.json();case 11:a=e.sent,n=(null===(t=a.errors)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.message)||"Failed to create user. Status: ".concat(i.status," - ").concat(i.statusText),(0,F.showAlertDialog)(this,{title:n}),e.next=19;break;case 16:null===(r=this._params)||void 0===r||r.refreshUsers(),(0,F.showAlertDialog)(this,{title:"User created successfully"}),this._close();case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(4),this._error=e.t0.message||"Unknown error",(0,F.showAlertDialog)(this,{title:"Error Creating User ".concat(e.t0.message)});case 25:case"end":return e.stop()}}),e,this,[[4,21]])}))),function(){return p.apply(this,arguments)})},{kind:"method",key:"_renderUserFields",value:function(){var e,s,i,t=this._user;return t?(0,U.qy)(ee||(ee=(0,r.A)([" "," ",' <ha-settings-row> <span slot="heading"> ',' </span> <span slot="description"> ',' </span> <ha-switch .disabled="','" .checked="','" @change="','"></ha-switch> </ha-settings-row> <ha-settings-row> <span slot="heading"> ',' </span> <span slot="description"> ',' </span> <ha-switch .disabled="','" .checked="','" @change="','"></ha-switch> </ha-settings-row> '])),t.system_generated?U.s6:(0,U.qy)(se||(se=(0,r.A)([' <ha-settings-row> <span slot="heading"> ',' </span> <span slot="description">',"</span> "," </ha-settings-row> "])),this.hass.localize("ui.panel.config.person.detail.username"),t.username,null!==(e=this.hass.user)&&void 0!==e&&e.is_owner?(0,U.qy)(ie||(ie=(0,r.A)([' <ha-icon-button .path="','" @click="','" .label="','"></ha-icon-button> '])),re,this._changeUsername,this.hass.localize("ui.panel.config.person.detail.change_username")):U.s6),!t.system_generated&&null!==(s=this.hass.user)&&void 0!==s&&s.is_owner?(0,U.qy)(te||(te=(0,r.A)([' <ha-settings-row> <span slot="heading"> ',' </span> <span slot="description">************</span> '," </ha-settings-row> "])),this.hass.localize("ui.panel.config.person.detail.password"),null!==(i=this.hass.user)&&void 0!==i&&i.is_owner?(0,U.qy)(ae||(ae=(0,r.A)([' <ha-icon-button .path="','" @click="','" .label="','"></ha-icon-button> '])),re,this._changePassword,this.hass.localize("ui.panel.config.person.detail.change_password")):U.s6):U.s6,this.hass.localize("ui.panel.config.person.detail.local_access_only"),this.hass.localize("ui.panel.config.person.detail.local_access_only_description"),t.system_generated,this._localOnly,this._localAccessOnlyChanged,this.hass.localize("ui.panel.config.person.detail.admin"),this.hass.localize("ui.panel.config.person.detail.admin_description"),t.system_generated||t.is_owner,this._isAdmin,this._adminChanged):U.s6}},{kind:"method",key:"_changePassword",value:(n=(0,l.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._user){e.next=2;break}return e.abrupt("return");case 2:if(this._user.credentials.find((function(e){return"homeassistant"===e.type}))){e.next=6;break}return(0,F.showAlertDialog)(this,{title:"No Home Assistant credentials found."}),e.abrupt("return");case 6:(0,G.M)(this,{userId:this._user.id});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{kind:"method",key:"_changeUsername",value:(a=(0,l.A)((0,o.A)().mark((function e(){var s,i;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._user){e.next=2;break}return e.abrupt("return");case 2:if(this._user.credentials.find((function(e){return"homeassistant"===e.type}))){e.next=6;break}return(0,F.showAlertDialog)(this,{title:"No Home Assistant credentials found."}),e.abrupt("return");case 6:return e.next=8,(0,F.showPromptDialog)(this,{inputLabel:this.hass.localize("ui.panel.config.users.change_username.new_username"),confirmText:this.hass.localize("ui.panel.config.users.change_username.change"),title:this.hass.localize("ui.panel.config.users.change_username.caption"),defaultValue:this._user.username});case 8:if(!(s=e.sent)){e.next=21;break}return e.prev=10,e.next=13,(0,j.Gk)(this.hass,this._user.id,s);case 13:null===(i=this._params)||void 0===i||i.refreshUsers(),this._user=Object.assign(Object.assign({},this._user),{},{username:s}),(0,F.showAlertDialog)(this,{text:this.hass.localize("ui.panel.config.users.change_username.username_changed")}),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),(0,F.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.users.change_username.failed"),text:e.t0.message});case 21:case"end":return e.stop()}}),e,this,[[10,18]])}))),function(){return a.apply(this,arguments)})},{kind:"method",key:"_updateEntry",value:(t=(0,l.A)((0,o.A)().mark((function e(){var s,i,t,a,n;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._submitting=!0,e.prev=1,!(this._userId&&this._name!==(null===(s=this._params.entry)||void 0===s?void 0:s.name)||this._isAdmin!==(null===(i=this._user)||void 0===i?void 0:i.group_ids.includes(V.wj))||this._localOnly!==(null===(t=this._user)||void 0===t?void 0:t.local_only))){e.next=6;break}return e.next=5,(0,V.TK)(this.hass,this._userId,{name:this._name.trim(),group_ids:[this._isAdmin?V.wj:V.eR],local_only:this._localOnly});case 5:null===(a=this._params)||void 0===a||a.refreshUsers();case 6:if(n={name:this._name.trim(),device_trackers:this._deviceTrackers,user_id:this._userId||null,picture:this._picture},!this._params.entry){e.next=12;break}return e.next=10,this._params.updateEntry(n);case 10:e.next=15;break;case 12:return e.next=14,this._params.createEntry(n);case 14:this._personExists=!0;case 15:this._params=void 0,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),this._error=e.t0?e.t0.message:"Unknown error";case 21:return e.prev=21,this._submitting=!1,e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[1,18,21,24]])}))),function(){return t.apply(this,arguments)})},{kind:"method",key:"_deleteEntry",value:(i=(0,l.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._submitting=!0,e.prev=1,e.next=4,this._params.removeEntry();case 4:if(!e.sent){e.next=7;break}this._params.entry.user_id&&(0,V.hG)(this.hass,this._params.entry.user_id),this._params=void 0;case 7:return e.prev=7,this._submitting=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,this,[[1,,7,10]])}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"_adminChanged",value:function(e){var s=e.target;this._isAdmin=s.checked}},{kind:"method",key:"_close",value:function(){var e;!this._personExists&&this._userId&&((0,V.hG)(this.hass,this._userId),null===(e=this._params)||void 0===e||e.refreshUsers(),this._userId=void 0);this._params=void 0}},{kind:"get",static:!0,key:"styles",value:function(){return[H.nA,(0,U.AH)(ne||(ne=(0,r.A)(["ha-password-field,ha-picture-upload,ha-textfield{display:block;margin-bottom:16px}ha-picture-upload{--file-upload-image-border-radius:50%}ha-settings-row{padding:0}a{color:var(--primary-color)}.error{color:var(--error-color);margin-bottom:16px}.building-selection{margin-bottom:16px}.building-selection label{display:block;margin-bottom:4px}.building-selection select{width:100%;padding:8px;font-size:14px}"])))]}}]}}),U.WF),n(),e.next=90;break;case 87:e.prev=87,e.t2=e.catch(0),n(e.t2);case 90:case"end":return e.stop()}}),e,null,[[0,87]])})));return function(s,i){return e.apply(this,arguments)}}())},50070:function(e,s,i){i.d(s,{M:function(){return n}});i(95737),i(39790),i(66457),i(99019),i(96858);var t=i(34897),a=function(){return Promise.all([i.e(9421),i.e(31524)]).then(i.bind(i,16442))},n=function(e,s){(0,t.r)(e,"show-dialog",{dialogTag:"dialog-admin-change-password",dialogImport:a,dialogParams:s})}}}]);
//# sourceMappingURL=9717.7w6Ux_giuj0.js.map