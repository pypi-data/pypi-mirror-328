"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[16733],{16733:function(e,t,i){var s=i(22858).A,a=i(33994).A;i.a(e,function(){var e=s(a().mark((function e(s,r){var n,o,l,d,u,c,h,p,_,m,k,f,v,g,y,b,x,w,A,U,E,T,z,C,q,I,D,M,F,O,V,S,j,B;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i.r(t),i.d(t,{DialogPersonBuildingDetail:function(){return B}}),n=i(64599),o=i(33994),l=i(22858),d=i(35806),u=i(71008),c=i(62193),h=i(2816),p=i(27927),_=i(88871),m=i(81027),k=i(44124),f=i(50693),v=i(72735),g=i(39790),y=i(66457),b=i(79641),x=i(253),w=i(94438),A=i(15112),U=i(29818),E=i(56864),i(77372),T=i(3276),i(24284),i(28066),z=i(52992),i(24640),i(90431),i(32084),C=i(71443),q=i(6121),I=i(55321),D=i(18858),!(M=s([E,z])).then){e.next=54;break}return e.next=50,M;case 50:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=55;break;case 54:e.t0=M;case 55:F=e.t0,E=F[0],z=F[1],B=(0,p.A)([(0,U.EM)("dialog-person-building-detail")],(function(e,t){var i,s,a,r=function(t){function i(){var t;(0,u.A)(this,i);for(var s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return t=(0,c.A)(this,i,[].concat(a)),e(t),t}return(0,h.A)(i,t),(0,d.A)(i)}(t);return{F:r,d:[{kind:"field",decorators:[(0,U.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,U.wk)()],key:"_name",value:function(){return""}},{kind:"field",decorators:[(0,U.wk)()],key:"_userId",value:void 0},{kind:"field",decorators:[(0,U.wk)()],key:"_user",value:void 0},{kind:"field",decorators:[(0,U.wk)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,U.wk)()],key:"_params",value:void 0},{kind:"field",decorators:[(0,U.wk)()],key:"_submitting",value:function(){return!1}},{kind:"field",decorators:[(0,U.wk)()],key:"_personExists",value:function(){return!1}},{kind:"field",decorators:[(0,U.wk)()],key:"_buildingUrl",value:function(){return""}},{kind:"field",decorators:[(0,U.wk)()],key:"_accessToken",value:function(){return""}},{kind:"method",key:"showDialog",value:(a=(0,l.A)((0,o.A)().mark((function e(t){var i=this;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._params=t,this._error=void 0,this._params.entry?(this._personExists=!0,this._name=this._params.entry.name||"",this._userId=this._params.entry.user_id||void 0,this._user=this._userId?this._params.users.find((function(e){return e.id===i._userId})):void 0):(this._personExists=!1,this._name="",this._userId=void 0,this._user=void 0),this._buildingUrl="",this._accessToken="",e.next=7,this.updateComplete;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{kind:"method",key:"render",value:function(){if(!this._params)return A.s6;var e=""===this._name.trim();return(0,A.qy)(O||(O=(0,n.A)([' <ha-dialog open @closed="','" scrimClickAction escapeKeyAction .heading="','"> <div> ',' <div class="form"> <ha-textfield class="name" name="name" .value="','" @input="','" label="','" required .validationMessage="','" dialogInitialFocus></ha-textfield> <ha-textfield class="display-name" name="buildingUrl" .value="','" @input="','" label="','" required .validationMessage="','"></ha-textfield> <ha-textfield class="display-name" name="accessToken" .value="','" @input="','" label="Access Token" required .validationMessage="','"></ha-textfield> </div> </div> ',' <ha-button slot="primaryAction" @click="','" .disabled="','"> '," </ha-button> </ha-dialog> "])),this._close,(0,T.l)(this.hass,this._params.entry?this._params.entry.name:this.hass.localize("ui.panel.config.person.detail.name")),this._error?(0,A.qy)(V||(V=(0,n.A)(['<div class="error">',"</div>"])),this._error):"",this._name,this._handleValueChanged,this.hass.localize("ui.panel.config.building.name"),this.hass.localize("ui.common.error_required"),this._buildingUrl,this._handleValueChanged,this.hass.localize("ui.panel.config.building.url"),this.hass.localize("ui.common.error_required"),this._accessToken,this._handleValueChanged,this.hass.localize("ui.common.error_required"),this._params.entry?(0,A.qy)(S||(S=(0,n.A)([' <ha-button slot="secondaryAction" class="warning" @click="','" .disabled="','"> '," </ha-button> "])),this._deleteEntry,this._user&&this._user.is_owner||this._submitting,this.hass.localize("ui.panel.config.person.detail.delete")):A.s6,this._createOrUpdateEntry,e||this._submitting,this._params.entry?this.hass.localize("ui.panel.config.person.detail.update"):this.hass.localize("ui.panel.config.person.detail.create"))}},{kind:"method",key:"_handleValueChanged",value:function(e){this._error=void 0;var t=e.target;switch(t.name){case"name":this._name=t.value;break;case"buildingUrl":this._buildingUrl=t.value;break;case"accessToken":this._accessToken=t.value}}},{kind:"method",key:"_createOrUpdateEntry",value:(s=(0,l.A)((0,o.A)().mark((function e(){var t,i,s,a,r;return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={name:this._name,building_url:this._buildingUrl,access_token:this._accessToken},e.prev=1,e.next=4,fetch("".concat(D.u,"/building/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 4:if((i=e.sent).ok){e.next=13;break}return e.next=8,i.json();case 8:a=e.sent,r=(null===(s=a.errors)||void 0===s||null===(s=s[0])||void 0===s?void 0:s.message)||"Failed to register building. Status: ".concat(i.status," - ").concat(i.statusText),(0,q.showAlertDialog)(this,{title:r}),e.next=15;break;case 13:(0,q.showAlertDialog)(this,{title:"Building created successfully"}),this._close();case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),this._error=e.t0.message||"Unknown error",(0,q.showAlertDialog)(this,{title:"Error Creating User ".concat(e.t0.message)});case 21:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(){return s.apply(this,arguments)})},{kind:"method",key:"_deleteEntry",value:(i=(0,l.A)((0,o.A)().mark((function e(){return(0,o.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._submitting=!0,e.prev=1,e.next=4,this._params.removeEntry();case 4:if(!e.sent){e.next=7;break}this._params.entry.user_id&&(0,C.hG)(this.hass,this._params.entry.user_id),this._params=void 0;case 7:return e.prev=7,this._submitting=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,this,[[1,,7,10]])}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"_close",value:function(){var e;!this._personExists&&this._userId&&((0,C.hG)(this.hass,this._userId),null===(e=this._params)||void 0===e||e.refreshUsers(),this._userId=void 0);this._params=void 0}},{kind:"get",static:!0,key:"styles",value:function(){return[I.nA,(0,A.AH)(j||(j=(0,n.A)(["ha-password-field,ha-picture-upload,ha-textfield{display:block;margin-bottom:16px}ha-picture-upload{--file-upload-image-border-radius:50%}ha-settings-row{padding:0}a{color:var(--primary-color)}.error{color:var(--error-color);margin-bottom:16px}.building-selection{margin-bottom:16px}.building-selection label{display:block;margin-bottom:4px}.building-selection select{width:100%;padding:8px;font-size:14px}"])))]}}]}}),A.WF),r(),e.next=65;break;case 62:e.prev=62,e.t2=e.catch(0),r(e.t2);case 65:case"end":return e.stop()}}),e,null,[[0,62]])})));return function(t,i){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=16733.WR2b5_KOcXs.js.map