version: "1.0"
metadata:
  description: "Authorization Policy Test Cases"

test_cases:
  - name: deny_post_8080
    input: "Deny results with POST method on port 8080 on all workloads in the foo namespace"
    category: AuthorizationPolicy
    expected_output:
      apiVersion: security.istio.io/v1
      kind: AuthorizationPolicy
      metadata:
        name: httpbin
        namespace: foo
      spec:
        action: DENY
        rules:
          - to:
              - operation:
                  methods:
                    - POST
                  ports:
                    - "8080"

  - name: allow_get_3000
    input: "Allow GET requests on port 3000 for service-a in the bar namespace"
    category: AuthorizationPolicy
    expected_output:
      apiVersion: security.istio.io/v1
      kind: AuthorizationPolicy
      metadata:
        name: service-a
        namespace: bar
      spec:
        action: ALLOW
        rules:
          - to:
              - operation:
                  methods:
                    - GET
                  ports:
                    - "3000"
  - name: allow_nothing
    input: "Create an allow nothing policy in the foo namespace"
    category: AuthorizationPolicy
    expected_output:
      apiVersion: security.istio.io/v1
      kind: AuthorizationPolicy
      metadata:
      name: allow-nothing
      namespace: foo
      spec:
        {}
  - name: allow_nothing_1
    input: "Deny all requests between the workloads in the foo namespace"
    category: AuthorizationPolicy
    expected_output:
      apiVersion: security.istio.io/v1
      kind: AuthorizationPolicy
      metadata:
      name: allow-nothing
      namespace: foo
      spec:
        {}

  - name: allow_all
    input: "Allow all requests in the default namespace"
    category: AuthorizationPolicy
    expected_output:
      apiVersion: security.istio.io/v1
      kind: AuthorizationPolicy
      metadata:
      name: allow-all
      namespace: foo
      spec:
      rules:
      - {}